(this["webpackJsonp3rww-rainfall-viz"]=this["webpackJsonp3rww-rainfall-viz"]||[]).push([[0],{197:function(e,t,a){},210:function(e,t,a){e.exports=a(381)},217:function(e,t,a){},218:function(e,t,a){},299:function(e,t,a){},319:function(e,t,a){},348:function(e,t,a){},349:function(e,t,a){},352:function(e,t,a){},356:function(e,t,a){},358:function(e,t,a){},377:function(e,t,a){},378:function(e,t,a){},379:function(e,t,a){},380:function(e,t,a){},381:function(e,t,a){"use strict";a.r(t);var n,r,o=a(0),l=a.n(o),i=a(18),c=a.n(i),s=a(10),u=a(8),p=a(7),d=a(71),m=a(9),h=a(37),f=a(6),g=a.n(f),y=a(417),b=a(407),v=a(40),E=a(402),O=a(415),w=a(405),j=a(200),x=window.location.href,T=x+"static/data/geography-lookup.json",k=Number("2000"),D=["15-minute","Hourly","Daily","Total"],C="".concat("2000-04-01"),S="historic",A="realtime",N={pixel:"pixel",gauge:"gauge"},L="legacyRealtime",I="legacyGauge",R="legacyGarr",_={ts:"timestamp",val:"rainfall",src:"source",id:"sensor id",type:"sensor type"},P=[{INDEX:8,id:"pixel",type:"line",source:"pixel",layout:{},paint:{"line-color":"hsl(209, 25%, 55%)","line-width":.5,"line-opacity":.2}},{INDEX:68,id:"".concat("HIGHLIGHT","-pixel-fill"),type:"fill",source:"pixel",layout:{},paint:{"fill-color":"#2196f3","fill-opacity":["case",["boolean",["get","selected"],!1],.2,0]}},{INDEX:70,id:"".concat("HIGHLIGHT","-pixel"),type:"line",source:"pixel",layout:{},paint:{"line-color":"#2196f3","line-width":1,"line-opacity":["case",["boolean",["get","selected"],!1],1,0]}},{INDEX:69,id:"pixel-results",type:"fill",source:"pixel",layout:{},paint:{"fill-color":["match",["get","total"],"","#fff",["interpolate",["linear"],["get","total"],0,"#fafa6e",10,"#2A4858"]],"fill-opacity":["match",["get","total"],"",0,.8]}},{INDEX:71,id:"".concat("HOVER","-pixel"),type:"fill",source:"pixel",layout:{},paint:{"fill-color":"#cad2d3","fill-opacity":["case",["boolean",["feature-state","hover"],!1],.8,0]}},{INDEX:72,id:"".concat("HIGHLIGHT","-gauge"),type:"circle",source:"gauge",layout:{},paint:{"circle-radius":["interpolate",["linear"],["zoom"],7,6,18,12],"circle-color":"#2196f3","circle-stroke-color":"#fff","circle-stroke-width":2,"circle-opacity":["case",["boolean",["get","selected"],!1],.4,0],"circle-stroke-opacity":["case",["boolean",["get","selected"],!1],1,0]}},{INDEX:73,id:"".concat("HOVER","-gauge"),type:"circle",source:"gauge",layout:{},paint:{"circle-radius":["interpolate",["linear"],["zoom"],7,6,18,12],"circle-color":"hsl(209, 25%, 55%)","circle-stroke-color":"#fff","circle-stroke-width":2,"circle-opacity":["case",["boolean",["feature-state","hover"],!1],1,0],"circle-stroke-opacity":["case",["boolean",["feature-state","hover"],!1],1,0]}},{id:"pixel-points",type:"circle",source:"pixel",layout:{visibility:"none"},paint:{"circle-color":"hsl(209, 25%, 55%)","circle-opacity":0,"circle-stroke-width":1,"circle-stroke-color":"hsl(0, 0%, 31%)","circle-radius":0}},{id:"gauges",type:"circle",source:"gauge",paint:{"circle-radius":["interpolate",["linear"],["zoom"],7,3,18,9],"circle-stroke-color":"hsl(0, 100%, 100%)","circle-stroke-opacity":.5,"circle-color":"#708da9"}},{id:"gauge-results",type:"circle",source:"gauge",layout:{},paint:{"circle-radius":["interpolate",["linear"],["zoom"],7,8,18,14],"circle-stroke-color":"#fff","circle-stroke-width":2,"circle-color":["match",["get","total"],"","#fff",["interpolate",["linear"],["get","total"],0,"#fafa6e",10,"#2A4858"]],"circle-opacity":["match",["get","total"],"",0,1],"circle-stroke-opacity":["match",["get","total"],"",0,1]}},{id:"gauges-labels",type:"symbol",source:"gauge",layout:{"text-field":["to-string",["get","name"]],"text-anchor":"top","text-size":["interpolate",["linear"],["zoom"],8,12,18,18],"text-offset":[0,.75]},paint:{"text-color":"#708da9","text-halo-width":2,"text-halo-color":"hsl(0, 0%, 100%)"}}],G=[["".concat("HOVER","-pixel"),"pixel"],["".concat("HOVER","-gauge"),"gauge"]],M=["pixel-results","gauge-results"],H=["#fde725","#5dc962","#20908d","#3a528b","#440154"],Y=[.1,.2,.4,.6,.8,1,1.5,2,2.5,3,3.5,4,4.5,5],q={breaks_005:[.01,.02,.04,.06,.08,.1,.12,.15,.2,.25,.3,.35,.4,.45,.5],breaks_050:Y,breaks_100:[.2,.4,.8,1,1.2,1.6,2,2.4,3,4,5,6,7,8,9,10]},F={progress:{tab:L,mapLoaded:!1,initialStyleLoaded:!1,isFetching:!0,isThinking:0,messages:[]},fetchKwargs:(n={},Object(p.a)(n,L,{active:{startDt:null,endDt:null,sensorLocations:{gauge:[],geographies:[],pixel:[]},rollup:"15-minute",zerofill:!0,f:"sensor"},history:[]}),Object(p.a)(n,I,{active:{startDt:null,endDt:null,sensorLocations:{gauge:[],geographies:[],pixel:[]},rollup:"15-minute",zerofill:!0,f:"sensor"},history:[]}),Object(p.a)(n,R,{active:{startDt:null,endDt:null,sensorLocations:{gauge:[],geographies:[],pixel:[]},rollup:"15-minute",zerofill:!0,f:"sensor"},history:[]}),n),rainfallEvents:{list:[],stats:{latest:null,longest:null,maxDate:null,minDate:C},filters:{maxHours:24}},stats:{latest:{}},refData:{},initMap:{token:"pk.eyJ1IjoiY2l2aWNtYXBwZXIiLCJhIjoiY2s2azUycjc4MDBvMzNsbnliZDU4dTZiZCJ9.35H-OLQdcpQuCjKE9iAmwg",latitude:40.4481524,longitude:-79.9864242,zoom:10,mapboxSources:{"3rww-rainfall-base":{type:"vector",url:"mapbox://styles/civicmapper/ck2xlf5qg2pbc1clav3r8ddku"}},sourcesToAdd:[],layersToAdd:[],attribution:'<a href="https://www.3riverswetweather.org" target="_blank">3RWW</a>, <a href="https://www.civicmapper.com" target="_blank">CivicMapper</a>.'},mapStyle:{},mapLegend:{}},W=Object(u.b)("MAP_LOADED"),z=Object(u.b)("SET_STYLE"),K=Object(u.b)("LOAD_REF_LAYERS"),B=Object(u.b)("SWITCH_TAB"),V=Object(u.b)("ASYNC_START"),X=Object(u.b)("ASYNC_SUCCESS"),J=Object(u.b)("ASYNC_FAIL"),Q=Object(u.b)("FETCHING"),U=Object(u.b)("THINKING_1"),Z=Object(u.b)("THINKING_0"),$=Object(u.b)("CALC_EVENT_STATS"),ee=Object(u.b)("PICK_EVENT"),te=Object(u.b)("PICK_DATETIME_RANGE"),ae=Object(u.b)("PICK_SENSOR"),ne=Object(u.b)("PICK_INTERVAL"),re=Object(u.b)("PICK_ACTIVE_RESULT"),oe=Object(u.b)("GETTING_RAINFALL"),le=(Object(u.b)("GETTING_RAINFALL_INVALID"),Object(u.b)("GETTING_RAINFALL_SUCCESS")),ie=Object(u.b)("GETTING_RAINFALL_FAIL"),ce=Object(u.b)("FILTER_EVENT_BY_HOUR"),se=Object(u.b)("HIGHLIGHT_SENSOR"),ue=Object(u.b)("APPLY_COLOR_STRETCH"),pe=Object(u.b)("SET_LAYER_STYLE"),de=Object(u.b)("BUILD_LAYER_STYLE"),me=Object(u.b)("RESET_LAYER_SRCS"),he=(Object(u.b)("START_ANIMATION"),Object(u.b)("STOP_ANIMATION"),Object(u.b)("RESTART_ANIMATION"),Object(u.b)("SET_STATE")),fe=(a(414),a(386)),ge=function(e){return e.progress.tab},ye=function(e,t){return e.fetchKwargs[t].active},be=function(e,t){return e.fetchKwargs[t].history},ve=function(e){return function(e){return e.fetchKwargs[ge(e)].history}(e).find((function(e){return!0===e.isActive}))},Ee=function(e,t,a){return be(e,a).find((function(e){return e.requestId==t}))},Oe=function(e,t,a){var n=e.fetchKwargs[t].active.sensorLocations[a];return void 0===n?[]:n},we=function(e,t){return function(e){return e.mapStyle.sources}(e)[t]},je=function(e){return e.mapStyle.layers},xe=function(e,t){return je(e).filter((function(e){return Object(b.a)(t,e.id)}))},Te=function(e,t){return Object(O.a)(e.mapStyle,["sources",t,"data","features"])?e.mapStyle.sources[t].data.features:[]},ke=function(e,t){return Object(j.a)(e.refData.lookups,t,{})},De=function(e){return e.rainfallEvents},Ce=function(e){return e.stats.latest},Se=function(e){return Ce(e)["calibrated-gauge"]},Ae=function(e){return Ce(e)["calibrated-radar"]},Ne=a(52),Le=a(416),Ie=(a(409),function(e,t){var a=e.map((function(e){return e[t]})).filter((function(e){return e>=0}));return{maxValue:Math.max.apply(Math,Object(h.a)(a)),minValue:Math.min.apply(Math,Object(h.a)(a)),maxRank:a.length}}),Re=function(e,t,a,n,r,o,l,i){var c=Ne.scale(n);r&&(c=c.mode(r)),void 0===o&&(o=5),void 0===a&&(a="id");var s,u,p=["match",["get",a]],d=["match",["get",a]],m=[],h=[];void 0===i?(i=Ie(e,t),console.log("minMax on the fly",i)):console.log("minMax provided",i),s=i.maxValue,u=i.minValue,void 0===l?(l="linear",m=Ne.limits(e.map((function(e){return e[t]})),"e",o).slice(1),h=c.colors(o),e.forEach((function(e){var n=(e[t]-u)/(s-u),r=c.classes(o)(n).hex("rgb");p.push(e[a],r)}))):(h=(m=Ne.limits(e.map((function(e){return e[t]})),l,o).slice(1)).map((function(e){var t=m.indexOf(m.filter((function(t){return e<=t}))[0])/m.length;return Ne.scale(n).classes(o)(t).brighten(.25).saturate(.25).hex("rgb")})),e.forEach((function(e){var n=m.indexOf(m.filter((function(a){return e[t]<=a}))[0])/m.length,r=c.classes(o)(n).brighten(.25).saturate(.25).hex("rgb");p.push(e[a],r)})));e.forEach((function(e){var n=500*e[t];d.push(e[a],n)}));var f={method:l,content:Object(Le.a)(m,h)};return p.push("rgba(255,255,255,0)"),d.push(0),{styleExp:p,legendContent:f,heightExp:d}},_e=["id"],Pe=["start_dt","end_dt","event_label","duration"],Ge=function(e){return{type:"geojson",data:{type:"FeatureCollection",features:e.features.map((function(e){return{properties:Object(m.a)({id:e.properties.pixel_id.toString(),label:"Virtual Gauge ".concat(e.properties.pixel_id.toString()),data:[],total:"",selected:!1},e.properties),id:e.properties.pixel_id.toString(),geometry:e.geometry}}))}}},Me=function(e){return{type:"geojson",data:{type:"FeatureCollection",features:e.features.filter((function(e){return e.properties.active})).map((function(e){var t=e.properties,a=(t.id,Object(d.a)(t,_e));return{properties:Object(m.a)({id:a.web_id,label:"Gauge ".concat(a.web_id,": ").concat(a.name),data:[],total:"",selected:!1,dwid:a.ext_id,active:a.active},a),id:a.web_id,geometry:e.geometry}}))}}},He=function(e){return e.map((function(e,t){return Object(m.a)(Object(m.a)({},e),{},{startDt:e.start_dt,endDt:e.end_dt,hours:e.duration,isFetching:!1,selected:!1,eventid:e.event_label})})).map((function(e){e.start_dt,e.end_dt,e.event_label,e.duration;return Object(d.a)(e,Pe)})).filter((function(e){return e.hours>0}))},Ye=function(e,t,a){void 0===a&&(a="properties.id"),void 0===t&&(t="properties.name");var n=Object(j.a)(e,a,!1),r=Object(j.a)(e,t,!1);return r?{value:n,label:"".concat(e.id,": ").concat(r)}:{value:n,label:"".concat(e.id)}},qe=["INDEX"],Fe=Object(u.c)(F,(r={},Object(p.a)(r,B,(function(e,t){e.progress.tab=t.payload})),Object(p.a)(r,V,(function(e,t){e.progress.isFetching=!0})),Object(p.a)(r,X,(function(e,t){e.progress.isFetching=!1;var a=t.payload,n=a.data,r=a.pathArray,o=a.keepACopy;if(Object(y.a)(e,r,n),!0===o){var l=["refData",r[r.length-1]];Object(y.a)(e,l,n)}})),Object(p.a)(r,J,(function(e,t){e.progress.isFetching=!1,console.log(t.payload)})),Object(p.a)(r,Q,(function(e,t){e.progress.isFetching=t.payload.isFetching})),Object(p.a)(r,U,(function(e,t){void 0!==t.payload&&(console.log(t.payload),e.progress.messages.push(t.payload)),e.progress.isThinking=e.progress.isThinking+1})),Object(p.a)(r,Z,(function(e,t){void 0!==t.payload&&(console.log(t.payload),e.progress.messages.push(t.payload)),e.progress.isThinking=e.progress.isThinking-1})),Object(p.a)(r,$,(function(e,t){var a=e.rainfallEvents.list,n=a.map((function(e){return e.endDt})).sort()[a.length-1];e.rainfallEvents.stats.latest=n,e.rainfallEvents.stats.longest=Math.max.apply(Math,Object(h.a)(a.map((function(e){return e.hours})))),e.rainfallEvents.stats.maxDate=g()(n).endOf("month").format()})),Object(p.a)(r,te,(function(e,t){var a=t.payload,n=a.contextType,r=a.startDt,o=a.endDt,l=ye(e,n);l.startDt=r,l.endDt=o,De(e).list.filter((function(e){return e.selected})).forEach((function(e){return!1===e.selected}))})),Object(p.a)(r,ee,(function(e,t){var a=t.payload,n=a.eventid,r=a.contextType,o=function(e,t){return De(e).list.find((function(e){return e.eventid===t}))}(e,n);o.selected=!0,function(e,t){return De(e).list.filter((function(e){return e.eventid!==t}))}(e,n).forEach((function(e,t){return e.selected=!1}));var l=ye(e,r);l.startDt=o.startDt,l.endDt=o.endDt})),Object(p.a)(r,ae,(function(e,t){var a=t.payload,n=a.contextType,r=a.sensorLocationType,o=a.selectedOptions;ye(e,n).sensorLocations[r]=null!==o?o.filter((function(e){return null!==e})):[]})),Object(p.a)(r,se,(function(e,t){var a=t.payload,n=(a.contextType,a.sensorLocationType),r=a.selectedOptions,o=r.map((function(e){return e.value}));null!==r?Te(e,n).forEach((function(e,t){Object(b.a)(o,e.id)?e.properties.selected=!0:e.properties.selected=!1})):Te(e,n).forEach((function(e,t){e.properties.selected=!1}))})),Object(p.a)(r,ne,(function(e,t){var a=t.payload,n=a.rollup,r=a.contextType;ye(e,r).rollup=n})),Object(p.a)(r,oe,(function(e,t){var a=t.payload,n=a.fetchKwargs,r=a.requestId,o=a.contextType,l=a.status,i=a.messages,c=Ee(e,r,o);void 0==c?be(e,o).push({fetchKwargs:n,requestId:r,isFetching:1,isActive:!1,results:!1,status:l,messages:i}):c.isFetching=c.isFetching+1})),Object(p.a)(r,le,(function(e,t){var a=t.payload,n=a.requestId,r=a.contextType,o=a.results,l=a.processedKwargs,i=a.status,c=a.messages;console.log("request",n,i),function(e,t,a){return be(e,a).filter((function(e){return e.requestId==t}))}(e,n,r).forEach((function(e){e.isFetching=e.isFetching-1,e.results=Object(m.a)(Object(m.a)({},o),e.results),e.processedKwargs=l,e.status=i,e.messages=c}))})),Object(p.a)(r,ie,(function(e,t){var a=t.payload,n=a.requestId,r=(a.results,a.status),o=a.messages;console.log(n,r);var l=function(e,t){var a;return Object(w.a)(e.fetchKwargs,(function(e,n){var r=e.history.find((function(e){return e.requestId==t}));void 0!==r&&(a=r)})),a}(e,n);l.isFetching=l.isFetching-1,l.status=r,l.messages=o})),Object(p.a)(r,re,(function(e,t){var a=t.payload,n=a.requestId,r=a.contextType;(function(e,t,a){return be(e,a).filter((function(e){return e.requestId!==t}))})(e,n,r).forEach((function(e){return e.isActive=!1}));var o=Ee(e,n,r);o.isActive=!0,Object(v.a)(o.results).forEach((function(t){console.log("getting reference ".concat(t," layer"));var a=Object(E.a)(e.refData[t].data),n=o.results[t];console.log("joining ".concat(t," results to layer"));var r=function(e,t,a,n,r){void 0===r&&(r=!1),void 0===a&&(a="id"),void 0===n&&(n=!1);var o=e.features.map((function(e){var o=t.find((function(t){return Object(j.a)(t,n)===Object(j.a)(e,a)}));return void 0===o?!r&&e:{id:e.id,geometry:e.geometry,properties:Object(m.a)(Object(m.a)({},e.properties),o)}}));return r&&(o=o.filter((function(e){return!1!==e}))),{type:"FeatureCollection",features:o}}(a,n,"properties.id","id",!1);console.log("pushing udpated ".concat(t," results layer to map")),we(e,t).data=r})),Object(v.a)(N).filter((function(e){return!Object(b.a)(Object(v.a)(o.results),e)})).forEach((function(t){console.log(t);var a=Object(E.a)(e.refData[t].data);we(e,t).data=a}))})),Object(p.a)(r,me,(function(e,t){var a=t.payload.lyrSrcNames;void 0===a&&(a=Object(v.a)(N)),a.length>0&&a.forEach((function(t){if(Object(O.a)(e.refData,t)){var a=Object(E.a)(e.refData[t].data);we(e,t).data=a}}))})),Object(p.a)(r,ce,(function(e,t){e.eventFilters.maxHours=t.payload.maxHours})),Object(p.a)(r,W,(function(e,t){return e.progress.mapLoaded||(e.progress.mapLoaded=!0),e})),Object(p.a)(r,z,(function(e,t){return e.mapStyle=t.payload,e.progress.initialStyleLoaded||(e.progress.initialStyleLoaded=!0),e})),Object(p.a)(r,K,(function(e,t){Object(w.a)(t.payload,(function(t,a){if(Object(O.a)(t,"INDEX")){var n=t.INDEX,r=Object(d.a)(t,qe),o=Object(h.a)(e.mapStyle.layers);o.splice(n,0,r),e.mapStyle.layers=o}else e.mapStyle.layers.push(t)}))})),Object(p.a)(r,he,(function(e,t){var a=t.payload,n=a.data,r=a.path,o=a.how;if("replace"===o)Object(y.a)(e,r,n);else if("append"===o){var l=Object(j.a)(e,r);Object(y.a)(e,r,[].concat(Object(h.a)(l),Object(h.a)(n)))}})),Object(p.a)(r,de,(function(e,t){var a=t.payload,n=a.requestId,r=a.contextType,o=a.sensor,l=Ee(e,n,r),i=Object(v.a)(l.results),c=[];i.forEach((function(e){c=c.concat(l.results[e])}));var s=Ie(c,"total");console.log(s);var u=Re(c,"total","id",H,"lch",7,"e",s);Object(y.a)(l,["styleExp",o],u.styleExp),Object(y.a)(l,["heightExp",o],u.heightExp),Object(y.a)(l,["legendContent",o],u.legendContent),l.stats=s})),Object(p.a)(r,pe,(function(e,t){var a=t.payload,n=a.requestId,r=a.contextType,o=(a.sensor,Ee(e,n,r)),l=Object(v.a)(o.results),i=Object(v.a)(N).filter((function(e){return!Object(b.a)(l,e)}));l.forEach((function(t){if(Object(O.a)(o,["styleExp",t])&&Object(O.a)(o,["heightExp",t])){var a=o.styleExp[t],n=o.heightExp[t],r=["".concat(t,"-results"),"".concat(t,"-results-3d")];xe(e,r).forEach((function(e){e.paint["".concat(e.type,"-color")]=a,"fill-extrusion"==e.type?(e.paint["".concat(e.type,"-base")]=0,e.paint["".concat(e.type,"-height")]=n,e.paint["".concat(e.type,"-opacity")]=1):e.paint["".concat(e.type,"-opacity")]=.5}))}else console.log("style and legend not previously calculated.")})),i.forEach((function(t){var a=["".concat(t,"-results")];xe(e,a).forEach((function(e){e.paint["".concat(e.type,"-color")]="#fff",e.paint["".concat(e.type,"-opacity")]=0}))}))})),Object(p.a)(r,ue,(function(e,t){var a=function(e,t,a,n,r,o){var l;void 0===t&&(t=Y),void 0===e&&(e="total"),void 0===n&&(n=H),void 0===r&&(r="lch"),l=void 0===a?Ne.scale(n).mode(r).domain([0,Math.max.apply(Math,Object(h.a)(t))]):a.domain([0,Math.max.apply(Math,Object(h.a)(t))]).classes(t),void 0===o&&(o="linear");var i=["interpolate",[o],["get",e]],c=[];return t.forEach((function(e){var t=l(e).hex("rgb");i.push(e),i.push(t),c.push([e,t])})),{colorExp:i,legendContent:c}}("total",t.payload.breaks),n=a.colorExp,r=a.legendContent;M.forEach((function(t){var a=function(e,t){return je(e).find((function(e){return e.id===t}))}(e,t);a.paint["".concat(a.type,"-color")]=n})),e.mapLegend.content=r})),r)),We=Object(u.a)({reducer:Fe,devTools:!0}),ze=(a(217),a(218),a(11)),Ke=a(12),Be=a(14),Ve=a(13),Xe=a(139),Je=a(17),Qe=a(389),Ue=a(203),Ze=a(406),$e=a(202),et=a(403),tt=a(392),at=a(387),nt=a(388),rt=a(412),ot=a(390),lt=a(114),it=a.n(lt),ct=(a(299),"\n## 3RWW Data API\n\nThe rainfall data is served up from 3RWW's Data **A**pplication **P**rogramming **I**nterface (API). Currently a few functions are documented and available through [".concat("https://trwwapi.herokuapp.com/rainfall/","](").concat("https://trwwapi.herokuapp.com/rainfall/",").\n\nFor API usage examples, see [this Jupyter notebook](https://github.com/3rww/notebooks/blob/master/rainfall/Engaging%20Rain%20Gauges.ipynb).\n\n## Project Roadmap\n\nYou can view the project roadmap on [Github](https://github.com/3rww/rainfall/projects/1). \n\nEncounter a bug or want to make a feature request? Submit an [issue](https://github.com/3rww/rainfall/issues) or email [3rww@civicmapper.com](mailto:3rww@civicmapper.com)\n\n\n")),st=function(){return l.a.createElement(at.a,{defaultActiveKey:"what2",id:"about-tabs",variant:"pills",mountOnEnter:!0},l.a.createElement(nt.a,{eventKey:"what2",title:"Overview"},l.a.createElement("div",{className:"about-body"},l.a.createElement("p",{className:"big-lead my-5"},l.a.createElement("strong",null,"3RWW Rainfall")," provides public access to high-resolution rainfall data downloads from gauges system and NEXRAD radar to support engineers and planners addressing wet weather issues in Allegheny County."),l.a.createElement(rt.a,{body:!0,className:"about-logo-background mb-5"},l.a.createElement("p",null,"This app is made possible with support from:"),l.a.createElement(Qe.a,{noGutters:!0},l.a.createElement(Ue.a,{sm:5},l.a.createElement(ot.a,{className:"about-logo mx-auto",src:"".concat(x,"static/assets/vieux-logo-white-300.png"),placeholder:"Vieux Associates",alt:"Vieux Associates",fluid:!0})),l.a.createElement(Ue.a,{sm:2},l.a.createElement(ot.a,{className:"about-logo mx-auto",src:"".concat(x,"static/assets/alcosan-logo.svg"),placeholder:"ALCOSAN",alt:"ALCOSAN",fluid:!0})),l.a.createElement(Ue.a,{sm:5},l.a.createElement(ot.a,{className:"about-logo mx-auto",src:"".concat(x,"static/assets/DataWise.png"),placeholder:"DataWise",alt:"DataWise",fluid:!0})))),l.a.createElement(it.a,{children:"\n\nCurrently, this site offers rainfall data in three buckets:\n\n* **Real-time Rainfall** data: provisional rainfall data from both rain gauges and radar pixels, updated every 15 minutes.\n* **Historical Rain Gauge** data: QA/QC'd rain gauge data, updated by the month within 30-60 days\n* **Calibrated Radar Rainfall** data: QA/QC'd, gauge-adjusted radar rainfall observations, updated by the month within 30-60 days\n\n### Real-time Rainfall Data\n\nProvisional data from 3RWW's 33 rain gauges and NEXRAD radar pixels is collected and updated every 15 minutes to provide accurate, quality rainfall information as it is occurring. This includes both gauge and radar rainfall data, provided by [DataWise](https://datawise.software/) and [Vieux Associates](https://www.vieuxinc.com/), respectively.\n\n> *Data users are cautioned to consider carefully the provisional nature of the information before using it for decisions. Information concerning the accuracy and appropriate uses of these data or concerning other hydrologic data may be obtained from the 3RWW.*\n\n### Historical Rain Gauge\n\nThe data from 33 rain gauges, which typically is updated to include data points not transmitted by the gauges in real-time, is available in this section. The data may be retrieved for any combination of the rain gauges during a specified time span. The data may also be displayed in 15-minute increments or aggregated to hourly or daily data points. [ALCOSAN](https://www.alcosan.org/) provides QA/QC'd rain gauge data.\n\n### Calibrated Radar Rainfall\n\nThe calibrated radar rainfall section allows the retrieval of archived gauge-adjusted radar rainfall data for each of the 2313 pixels mapped by the NEXRAD radar cross-section. Calibration is performed by [Vieux Associates](https://www.vieuxinc.com/).\n\n---\n\n# Need something more powerful?\n\nFor technical users requiring a more powerful visualization, querying, and data exploration capability, Vieux Associates provides an advanced internal tool at [vip.vieuxinc.com](https://vip.vieuxinc.com/). To request access, please email [aquinn@3rww.org](mailto:aquinn@3rww.org).\n"}))),l.a.createElement(nt.a,{eventKey:"what1",title:"Methods"},l.a.createElement("div",{className:"about-body"},l.a.createElement(it.a,{children:"\nHave you ever wondered how rainfall is actually measured? Technical instruments, called rain gauges, are designed to collect and accurately measure rainfall during wet weather events. However, a rain gauge can only provide a specific rainfall measurement for the limited geographic area where the gauge is located.\n\nOn the flip side, radar systems, often used in weather reports, do not measure rainfall directly, but rather they detect the intensity of microwave energy reflected by raindrops, called reflectivity. Through the use of a mathematical formula, the reflectivity of the raindrops can be converted by the radar system into rainfall estimates for a particular defined area.\n\nNeither measurement technique is perfect, but when the two are combined\u2014when radar estimates are calibrated with actual rain gauge data\u2014a highly accurate and valuable source of rainfall data can be calculated over large geographic areas.\n\nBecause engineers and planners addressing the wet weather issue need this level of accuracy, 3 Rivers Wet Weather created the calibrated radar rainfall system in 2001. Communities throughout Allegheny County use this data\u2014provided in both real-time and historical formats\u2014to design more cost-effective solutions to reduce or eliminate sewage overflows and improve stormwater management.\n\nThe NEXRAD radar (located in Moon Township) data is calibrated with the rain gauge measurements collected during the same time period and rain event for every square kilometer in Allegheny County. The resulting rainfall data is equivalent in accuracy to having 2,313 rain gauges placed across the County.\n"}))),l.a.createElement(nt.a,{eventKey:"how1",title:"Getting Data"},l.a.createElement("div",{className:"about-body"},l.a.createElement(it.a,{children:'\n## Querying Rainfall\n\nQuerying the rainfall data requires selecting the "when" and the "where".\n\n* First, select the start and end date/time. The available calendar selector provides pre-defined time ranges to help select time periods of interest. For historic gauge and calibrated radar rainfall data, a list of documented rainfall events provides another shortcut to selected date/time ranges.\n* Next, select the gauges or radar pixels. You can do this by \n  * clicking on the map;\n  * under "Where" in the "By Sensor" tab: selecting or typing (If you know the name or ID of the sensor) in the dropdown menus.\n  * under "Where" in the "By Geography" tab: selecting an ALCOSAN Planning Basin, Municipality, or Watershed, which will in turn select all coincident pixels for you\n* Then, optionally select the time interval to aggregate the results on: 15-minute (default), hourly, daily, or sum total. Rainfall data is collected and stored in 15-minute increments, which allows for 15-minute, hourly, and daily aggregations to be calculated. Note that if a daily interval is selected, the start and end selections will begin at midnight and the start and end hour will be ignored.\n* Finally, Press "Get Rainfall Data" button to get the data.\n\nQuery results will be listed in a panel below on each page and shown on the map. The tabular data output may be viewed and downloaded on the page by selecting the \'View and Download Results\' Button. Download formats currently include a CSV tabular format, for use in spreadsheet software. Spatial formats will be included in the future.\n\nThe output table for each query result contains:\n\n* a gauge or pixel ID\n* a date/time of the observation (presented as standard ISO 8061 datetime text). For hourly and daily aggregations, the start and end time of the observation is indicated using the standard ISO 8061 datetime range format, with start and end delimited by a "/".\n* a rainfall amount (in inches) \n* a source code, which indicates where the rainfall measurement came from. While all results include this, only Calibrated Radar Rainfall data will potentially indicate different codes, depending on the calibration methodology.\n\nThe following table describes the source code.\n\n| Source |\tDescription |\n| --- | --- |\n| R |\tCalibrated radar rainfall data |\n| G-0 | No gauge or calibrated radar rainfall data is available, but not for the reasons given for N/D below |\n| G-1 |\tDerived from inverse distance squared weighting based on one rain gauge |\n| G-2 |\tDerived from inverse distance squared weighting based on two rain gauges |\n| G-3 |\tDerived from inverse distance squared weighting based on three rain gauges |\n| N/D |\tNo data was collected for this data point. This may be because no data was collected at the time or the pixel may be outside of the data collection boundary. |\n| RTRR | Real-time radar rainfall. Data shown are provisional.|\n| RTRG | Real-time rain gauge data. Data shown are provisional. |\n\n> Note that the source code only appears for the 15-minute increments. Hourly or daily increment may include different source codes, depending on calibration method.\n'}))),l.a.createElement(nt.a,{eventKey:"more",title:"Demos"},l.a.createElement("div",{className:"about-body"},l.a.createElement("h3",null,"2021 Webinar"),l.a.createElement("p",null,"Our January 2021 webinar provides an overview of the rainfall system and a how-to for using this site."),l.a.createElement("div",{className:"embed-responsive embed-responsive-16by9"},l.a.createElement("iframe",{className:"embed-responsive-item",src:"https://www.youtube.com/embed/mwOu2QRx6oU",title:"YouTube video player",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})),l.a.createElement("hr",null),l.a.createElement("h3",null,"Boundary-based selections"),l.a.createElement("p",null,"A quick demo of the boundary-based selection feature:"),l.a.createElement("iframe",{src:"https://capture.dropbox.com/embed/XSWyyjHt6nXx2PdN?source=copy-embed",width:"560",height:"315",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:!0}))),l.a.createElement(nt.a,{eventKey:"how2",title:"Under the Hood"},l.a.createElement("div",{className:"about-body"},l.a.createElement(it.a,{children:ct}))))},ut=a(169),pt=a(170),dt=a.n(pt),mt=a(204),ht=a(410),ft=a(391),gt=a(411),yt=["contextType"];function bt(){bt=function(){return e};var e={},t=Object.prototype,a=t.hasOwnProperty,n=Object.defineProperty||function(e,t,a){e[t]=a.value},r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",l=r.asyncIterator||"@@asyncIterator",i=r.toStringTag||"@@toStringTag";function c(e,t,a){return Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(C){c=function(e,t,a){return e[t]=a}}function s(e,t,a,r){var o=t&&t.prototype instanceof d?t:d,l=Object.create(o.prototype),i=new T(r||[]);return n(l,"_invoke",{value:O(e,a,i)}),l}function u(e,t,a){try{return{type:"normal",arg:e.call(t,a)}}catch(C){return{type:"throw",arg:C}}}e.wrap=s;var p={};function d(){}function m(){}function h(){}var f={};c(f,o,(function(){return this}));var g=Object.getPrototypeOf,y=g&&g(g(k([])));y&&y!==t&&a.call(y,o)&&(f=y);var b=h.prototype=d.prototype=Object.create(f);function v(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){var r;n(this,"_invoke",{value:function(n,o){function l(){return new t((function(r,l){!function n(r,o,l,i){var c=u(e[r],e,o);if("throw"!==c.type){var s=c.arg,p=s.value;return p&&"object"==typeof p&&a.call(p,"__await")?t.resolve(p.__await).then((function(e){n("next",e,l,i)}),(function(e){n("throw",e,l,i)})):t.resolve(p).then((function(e){s.value=e,l(s)}),(function(e){return n("throw",e,l,i)}))}i(c.arg)}(n,o,r,l)}))}return r=r?r.then(l,l):l()}})}function O(e,t,a){var n="suspendedStart";return function(r,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===r)throw o;return D()}for(a.method=r,a.arg=o;;){var l=a.delegate;if(l){var i=w(l,a);if(i){if(i===p)continue;return i}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===n)throw n="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);n="executing";var c=u(e,t,a);if("normal"===c.type){if(n=a.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:a.done}}"throw"===c.type&&(n="completed",a.method="throw",a.arg=c.arg)}}}function w(e,t){var a=t.method,n=e.iterator[a];if(void 0===n)return t.delegate=null,"throw"===a&&e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method)||"return"!==a&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+a+"' method")),p;var r=u(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,p;var o=r.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function j(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(j,this),this.reset(!0)}function k(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(a.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:D}}function D(){return{value:void 0,done:!0}}return m.prototype=h,n(b,"constructor",{value:h,configurable:!0}),n(h,"constructor",{value:m,configurable:!0}),m.displayName=c(h,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,c(e,i,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},v(E.prototype),c(E.prototype,l,(function(){return this})),e.AsyncIterator=E,e.async=function(t,a,n,r,o){void 0===o&&(o=Promise);var l=new E(s(t,a,n,r),o);return e.isGeneratorFunction(a)?l:l.next().then((function(e){return e.done?e.value:l.next()}))},v(b),c(b,i,"Generator"),c(b,o,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),a=[];for(var n in t)a.push(n);return a.reverse(),function e(){for(;a.length;){var n=a.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=k,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(a,n){return l.type="throw",l.arg=e,t.next=a,n&&(t.method="next",t.arg=void 0),!!n}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],l=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var i=a.call(o,"catchLoc"),c=a.call(o,"finallyLoc");if(i&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(i){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var l=o?o.completion:{};return l.type=e,l.arg=t,o?(this.method="next",this.next=o.finallyLoc,p):this.complete(l)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var a=this.tryEntries[t];if(a.finallyLoc===e)return this.complete(a.completion,a.afterLoc),x(a),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var a=this.tryEntries[t];if(a.tryLoc===e){var n=a.completion;if("throw"===n.type){var r=n.arg;x(a)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,a){return this.delegate={iterator:k(e),resultName:t,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},e}function vt(e){return function(t){var a,n=e.url,r=e.pathArray,o=e.transformer,l=e.keepACopy;return t(U('getting data from "'.concat(n,'"'))),t(V(n)),dt()({url:n,method:"GET"}).then((function(e){return a=o?o(e.data):e.data,t(X({data:a,pathArray:r,keepACopy:l})),!0}),(function(e){return console.log("An error occurred.",e),t(J("An error occurred.")),!1})).finally((function(){return t(Z('data from "'.concat(n,'" loaded to ').concat(r.join("."))))}))}}function Et(e){return function(e){e(U("Loading reference data and map layers")),function(e){return Promise.all([new Promise((function(t,a){t(e(vt({url:"https://trwwapi.herokuapp.com/rainfall/rainfall-events/?format=json",pathArray:["rainfallEvents","list"],transformer:He,keepACopy:!1})))})),new Promise((function(t,a){t(e(vt({url:"https://trwwapi.herokuapp.com/rainfall/v2/latest-observations/?format=json",pathArray:["stats","latest"],transformer:!1,keepACopy:!1})))})),new Promise((function(t,a){t(e(vt({url:T,pathArray:["refData","lookups"],transformer:!1,keepACopy:!1})))})),new Promise((function(t,a){t(e(vt({url:"https://trwwapi.herokuapp.com/rainfall/gauges/",pathArray:["mapStyle","sources","gauge"],transformer:Me,keepACopy:!0})))})),new Promise((function(t,a){t(e(vt({url:"https://trwwapi.herokuapp.com/rainfall/pixels/",pathArray:["mapStyle","sources","pixel"],transformer:Ge,keepACopy:!0})))}))])}(e).then((function(t){e(K(P)),e(ue({breaks:Y}))})).then((function(){e(te({contextType:L,startDt:g()().subtract(2,"hour").toISOString(),endDt:g()().toISOString()}));var t=Se(We.getState());e(te({contextType:I,startDt:g()(t).subtract(1,"month").toISOString(),endDt:t}));var a=Ae(We.getState());e(te({contextType:R,startDt:g()(a).subtract(1,"month").toISOString(),endDt:a}))})).then((function(){return e(Z("Initial data load complete."))}))}}function Ot(e){var t=We.getState();return function(a){var n=e.contextType,r=e.rainfallDataType,o=ye(t,n),l=Object(mt.MD5)(o),i=Ee(t,l,n);void 0!==i&&(console.log("This exact request was already made. Keeping existing data from request",i.requestId),!1===i.isActive&&a(re({requestId:i.requestId,contextType:n})));["gauge","basin"].forEach((function(e,t){var i="basin"===e?["pixel","pixels"]:["gauge","gauges"];if(0!==o.sensorLocations[i[0]].length){var c={start_dt:o.startDt,end_dt:o.endDt,rollup:o.rollup,f:o.f};c[i[1]]=o.sensorLocations[i[0]].map((function(e){return e.value})).join(","),a(oe({fetchKwargs:o,requestId:l,contextType:n}));var s="".concat("https://trwwapi.herokuapp.com/rainfall/","v2/").concat(i[0],"/").concat(r,"/");!function e(t,a,n,r,o,l){var i={url:o,method:"POST"};!1!==l&&(i.data=l),dt()(i).then((function(o){var l=o.data;if(console.log("job ".concat(l.meta.jobId," ").concat(l.status," - ").concat(n)),Object(b.a)(["queued","started"],l.status))setTimeout((function(){return e(t,a,n,r,l.meta.jobUrl,!1)}),k);else if(Object(b.a)(["deferred","failed"],l.status))t(ie({requestId:a,contextType:r,results:Object(p.a)({},n,!1),status:l.status,messages:l.messages}));else if("finished"===l.status)try{null===l.data?(console.log("No data was returned."),t(ie({requestId:a,contextType:r,results:Object(p.a)({},n,!1),status:"error",messages:l.messages}))):(l=function(e){return e.data.forEach((function(e){var t=e.data.length>1&0!==e.data.length?e.data.filter((function(e){return e.val>=0})).map((function(e){return e.val})).reduce((function(e,t){return e+t}),0):e.data[0].val;e.total=t})),e}(l),t(le({requestId:a,contextType:r,results:Object(p.a)({},n,l.data),processedKwargs:l.args,status:l.status,messages:l.messages})),t(re({requestId:a,contextType:r})))}catch(i){console.log("An error occurred processing the result.",i),t(ie({requestId:a,contextType:r,results:Object(p.a)({},n,!1),status:"error",messages:l.messages}))}else"does not exist"===l.status&&(console.log("Job was cancelled."),t(ie({requestId:a,contextType:r,results:Object(p.a)({},n,!1),status:l.status,messages:l.messages})))}),(function(e){console.log("An error occurred.",e),t(ie({requestId:a,contextType:r,results:Object(p.a)({},n,!1),status:"error",messages:["An error occurred when trying to fetch the rainfall data.",e]}))})).catch((function(e){console.error("An error occurred.",e),t(ie({requestId:a,contextType:r,results:Object(p.a)({},n,!1),status:"error",messages:["An error occurred when trying to fetch the rainfall data.",e]}))}))}(a,l,i[0],n,s,c)}}))}}function wt(e){var t=e.contextType,a=Object(d.a)(e,yt);return function(e){var n=a.requestId;a.isActive||e(re({requestId:n,contextType:t}))}}function jt(e){var t=e;return function(e){e(B(t));var a=ve(We.getState());e(void 0===a?me({lyrSrcNames:Object(v.a)(N)}):re({requestId:a.requestId,contextType:t}))}}function xt(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=We.getState(),n=e.contextType,r=e.sensorLocationType,o=e.selectedOptions,l=e.inputType;return function(){var e=Object(ut.a)(bt().mark((function e(i){var c,s,u,p;return bt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=[],s=[],u=[],null===o&&0===Object(j.a)(o,"length",0)||(c=o.filter((function(e){return null!==e})),s=Object(h.a)(ye(a,n).sensorLocations[r]),console.log(r,"existing selection",s.map((function(e){return e.label}))),console.log(r,"incoming selection",c.map((function(e){return e.label}))),u="geomPicker"===l?c.length<s.length?Object(ht.a)(s,c,"value"):Object(ft.a)(s,c,"value"):Object(gt.a)(s,c,"value"),console.log(r,"new selection",u.map((function(e){return e.label})))),i(ae(p={contextType:n,sensorLocationType:r,selectedOptions:u})),t&&i(se(p));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}a(319);var Tt=function(e){Object(Be.a)(a,e);var t=Object(Ve.a)(a);function a(e,n){var r;return Object(ze.a)(this,a),(r=t.call(this,e,n)).handleShow=r.handleShow.bind(Object(Je.a)(r)),r.handleClose=r.handleClose.bind(Object(Je.a)(r)),r.state={show:!0,showWhich:"AboutButton",content:{AboutButton:{title:l.a.createElement(Qe.a,null,l.a.createElement(Ue.a,{lg:8},l.a.createElement("h1",null,"3RWW Rainfall ",l.a.createElement("small",null,l.a.createElement("em",null,"beta"))),l.a.createElement("p",{className:"lead"},"Map and download hyper-local rainfall measurements for Allegheny County")),l.a.createElement(Ue.a,null,l.a.createElement("small",null,"A project by "),l.a.createElement("br",null),l.a.createElement("img",{className:"brand-logo",src:"".concat(x,"static/assets/3rww_logo_full_inverse_transparent_blue.png"),placeholder:"3 River Wet Weather",alt:"3RWW Logo"}))),content:l.a.createElement(st,null)}}},r}return Object(Ke.a)(a,[{key:"handleClose",value:function(e){this.setState({show:!1,showWhich:null})}},{key:"handleShow",value:function(e){console.log(e.target.id),this.setState({show:!0,showWhich:e.target.id})}},{key:"render",value:function(){return l.a.createElement("div",{className:"nav-container"},l.a.createElement(Ze.a,{bg:"primary",variant:"dark",expand:"md"},l.a.createElement(Ze.a.Brand,{className:"d-none d-sm-block"},l.a.createElement("img",{className:"nav-brand-logo",src:"".concat(x,"static/assets/3rww_logo_full_inverse_transparent.png"),alt:"3RWW Logo"}),"\xa0 Rainfall ",l.a.createElement("small",null,l.a.createElement("em",null,"beta"))),l.a.createElement(Ze.a.Brand,{className:"d-block d-sm-none",style:{fontSize:"0.9rem"}},l.a.createElement("img",{className:"nav-brand-logo-xs",src:"".concat(x,"static/assets/3rww_logo_full_inverse_transparent.png"),alt:"3RWW Logo"}),"\xa0 Rainfall ",l.a.createElement("small",null,l.a.createElement("em",null,"beta"))),l.a.createElement(Ze.a.Toggle,{"aria-controls":"basic-navbar-nav"}),l.a.createElement(Ze.a.Collapse,{id:"basic-navbar-nav"},l.a.createElement($e.a,{variant:"pills",className:"mr-auto",defaultActiveKey:L},l.a.createElement($e.a.Item,null,l.a.createElement($e.a.Link,{active:this.props.tab===L,eventKey:L,onSelect:this.props.switchContext},"Real-Time Rainfall")),l.a.createElement($e.a.Item,null,l.a.createElement($e.a.Link,{active:this.props.tab===I,eventKey:I,onSelect:this.props.switchContext},"Historical Rain Gauge")),l.a.createElement($e.a.Item,null,l.a.createElement($e.a.Link,{active:this.props.tab===R,eventKey:R,onSelect:this.props.switchContext},"Calibrated Radar Rainfall"))),l.a.createElement($e.a,{className:"ml-auto"},l.a.createElement($e.a.Item,{className:"btn btn-outline-light btn-sm",id:"AboutButton",onClick:this.handleShow},"About")))),l.a.createElement(et.a,{show:this.state.show,onHide:this.handleClose,size:"lg"},l.a.createElement(et.a.Header,{closeButton:!0},l.a.createElement(et.a.Title,null,this.state.showWhich?this.state.content[this.state.showWhich].title:null)),l.a.createElement(et.a.Body,null,this.state.showWhich?this.state.content[this.state.showWhich].content:null),l.a.createElement(et.a.Footer,null,l.a.createElement(tt.a,{variant:"secondary",onClick:this.handleClose},"Close"))))}}]),a}(o.Component);var kt={switchContext:jt},Dt=Object(s.b)((function(e){return{isThinking:e.progress.isThinking>0,mapLoaded:e.progress.mapLoaded,tab:e.progress.tab}}),kt)(Tt),Ct=a(400),St=a(142),At=a(143),Nt=a(155),Lt=a(74),It=a.n(Lt),Rt=a(205),_t=a.n(Rt),Pt=a(393),Gt="setStyle",Mt="addLayer",Ht="removeLayer",Yt="setPaintProperty",qt="setLayoutProperty",Ft="setFilter",Wt="addSource",zt="removeSource",Kt="setGeoJSONSourceData",Bt="setLayerZoomRange",Vt="setLayerProperty",Xt="setCenter",Jt="setZoom",Qt="setBearing",Ut="setPitch",Zt="setSprite",$t="setGlyphs",ea="setTransition",ta="setLight";function aa(e,t,a){a.push({command:Wt,args:[e,t[e]]})}function na(e,t,a){t.push({command:zt,args:[e]}),a[e]=!0}function ra(e,t,a,n){na(e,a,n),aa(e,t,a)}function oa(e,t,a){var n;for(n in e[a])if(e[a].hasOwnProperty(n)&&"data"!==n&&!Object(Pt.a)(e[a][n],t[a][n]))return!1;for(n in t[a])if(t[a].hasOwnProperty(n)&&"data"!==n&&!Object(Pt.a)(e[a][n],t[a][n]))return!1;return!0}function la(e,t,a,n,r,o){var l;for(l in t=t||{},e=e||{})e.hasOwnProperty(l)&&(Object(Pt.a)(e[l],t[l])||a.push({command:o,args:[n,l,t[l],r]}));for(l in t)t.hasOwnProperty(l)&&!e.hasOwnProperty(l)&&(Object(Pt.a)(e[l],t[l])||a.push({command:o,args:[n,l,t[l],r]}))}function ia(e){return e.id}function ca(e,t){return e[t.id]=t,e}var sa=function(e,t){if(!e)return[{command:Gt,args:[t]}];var a=[];try{if(!Object(Pt.a)(e.version,t.version))return[{command:Gt,args:[t]}];Object(Pt.a)(e.center,t.center)||a.push({command:Xt,args:[t.center]}),Object(Pt.a)(e.zoom,t.zoom)||a.push({command:Jt,args:[t.zoom]}),Object(Pt.a)(e.bearing,t.bearing)||a.push({command:Qt,args:[t.bearing]}),Object(Pt.a)(e.pitch,t.pitch)||a.push({command:Ut,args:[t.pitch]}),Object(Pt.a)(e.sprite,t.sprite)||a.push({command:Zt,args:[t.sprite]}),Object(Pt.a)(e.glyphs,t.glyphs)||a.push({command:$t,args:[t.glyphs]}),Object(Pt.a)(e.transition,t.transition)||a.push({command:ea,args:[t.transition]}),Object(Pt.a)(e.light,t.light)||a.push({command:ta,args:[t.light]});var n={},r=[];!function(e,t,a,n){var r;for(r in t=t||{},e=e||{})e.hasOwnProperty(r)&&(t.hasOwnProperty(r)||na(r,a,n));for(r in t)t.hasOwnProperty(r)&&(e.hasOwnProperty(r)?Object(Pt.a)(e[r],t[r])||("geojson"===e[r].type&&"geojson"===t[r].type&&oa(e,t,r)?a.push({command:Kt,args:[r,t[r].data]}):ra(r,t,a,n)):aa(r,t,a))}(e.sources,t.sources,r,n);var o=[];e.layers&&e.layers.forEach((function(e){n[e.source]?a.push({command:Ht,args:[e.id]}):o.push(e)})),a=a.concat(r),function(e,t,a){t=t||[];var n,r,o,l,i,c,s,u=(e=e||[]).map(ia),p=t.map(ia),d=e.reduce(ca,{}),m=t.reduce(ca,{}),h=u.slice(),f=Object.create(null);for(n=0,r=0;n<u.length;n++)o=u[n],m.hasOwnProperty(o)?r++:(a.push({command:Ht,args:[o]}),h.splice(h.indexOf(o,r),1));for(n=0,r=0;n<p.length;n++)o=p[p.length-1-n],h[h.length-1-n]!==o&&(d.hasOwnProperty(o)?(a.push({command:Ht,args:[o]}),h.splice(h.lastIndexOf(o,h.length-r),1)):r++,c=h[h.length-n],a.push({command:Mt,args:[m[o],c]}),h.splice(h.length-n,0,o),f[o]=!0);for(n=0;n<p.length;n++)if(l=d[o=p[n]],i=m[o],!f[o]&&!Object(Pt.a)(l,i))if(Object(Pt.a)(l.source,i.source)&&Object(Pt.a)(l["source-layer"],i["source-layer"])&&Object(Pt.a)(l.type,i.type)){for(s in la(l.layout,i.layout,a,o,null,qt),la(l.paint,i.paint,a,o,null,Yt),Object(Pt.a)(l.filter,i.filter)||a.push({command:Ft,args:[o,i.filter]}),Object(Pt.a)(l.minzoom,i.minzoom)&&Object(Pt.a)(l.maxzoom,i.maxzoom)||a.push({command:Bt,args:[o,i.minzoom,i.maxzoom]}),l)l.hasOwnProperty(s)&&"layout"!==s&&"paint"!==s&&"filter"!==s&&"metadata"!==s&&"minzoom"!==s&&"maxzoom"!==s&&(0===s.indexOf("paint.")?la(l[s],i[s],a,o,s.slice(6),Yt):Object(Pt.a)(l[s],i[s])||a.push({command:Vt,args:[o,s,i[s]]}));for(s in i)i.hasOwnProperty(s)&&!l.hasOwnProperty(s)&&"layout"!==s&&"paint"!==s&&"filter"!==s&&"metadata"!==s&&"minzoom"!==s&&"maxzoom"!==s&&(0===s.indexOf("paint.")?la(l[s],i[s],a,o,s.slice(6),Yt):Object(Pt.a)(l[s],i[s])||a.push({command:Vt,args:[o,s,i[s]]}))}else a.push({command:Ht,args:[o]}),c=h[h.lastIndexOf(o)+1],a.push({command:Mt,args:[i,c]})}(o,t.layers,a)}catch(l){console.warn("Unable to compute style diff:",l),a=[{command:Gt,args:[t]}]}return a},ua=a(413),pa=a(418),da=function(e,t,a){return e>0&&1===e?t:a},ma=(a(348),function(e){var t=e.features;return t.filter((function(e){return void 0!==e.id})).length>0?l.a.createElement(rt.a,null,l.a.createElement(ua.a,{variant:"flush"},t.filter((function(e){return void 0!==e.id})).map((function(e,t){var a,n,r=e.properties;return l.a.createElement(ua.a.Item,{key:t},l.a.createElement("h6",{className:"tooltip-header"},r.label),""!==r.total?l.a.createElement("p",{className:"tooltip-body"},"Total rainfall: ",l.a.createElement("strong",null,(a=r.total,n=2,Object(pa.a)(a,n).toFixed(n)))," inches"):null)})))):null}),ha=a(394),fa=a(404),ga=(a(349),function(e){Object(Be.a)(a,e);var t=Object(Ve.a)(a);function a(){var e;Object(ze.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).handleSelectLegend=function(t){e.props.dispatchPickLegend(t.currentTarget.value)},e}return Object(Ke.a)(a,[{key:"render",value:function(){return l.a.createElement(Qe.a,{className:"my-2"},l.a.createElement(Ue.a,{sm:10},l.a.createElement(ha.a,{size:"sm"},l.a.createElement("tbody",null,l.a.createElement("tr",null,this.props.bins.map((function(e,t){return l.a.createElement("td",{key:t,className:"text-center legend-label",style:{backgroundColor:"".concat(e[1])}},l.a.createElement("span",{style:{color:"".concat(e[2])}},e[0]))}))))),l.a.createElement("span",{className:"form-check-label"},"Total Rainfall")),l.a.createElement(Ue.a,{sm:2},l.a.createElement(fa.a,null,l.a.createElement(fa.a.Check,{defaultChecked:!0,custom:!0,size:"sm",value:"breaks_005",label:"0.5 in.",name:"legendRadios",type:"radio",id:"legend-radio-1",onChange:this.handleSelectLegend}),l.a.createElement(fa.a.Check,{custom:!0,size:"sm",value:"breaks_050",label:"5 in.",name:"legendRadios",type:"radio",id:"legend-radio-2",onChange:this.handleSelectLegend}),l.a.createElement(fa.a.Check,{custom:!0,size:"sm",value:"breaks_100",label:"10 in.",name:"legendRadios",type:"radio",id:"legend-radio-3",onChange:this.handleSelectLegend}))))}}]),a}(l.a.Component));var ya=Object(s.b)((function(e){var t=!Object(fe.a)(e.mapLegend)&&e.mapLegend,a=t?t.content:[];return{bins:a=a.map((function(e,t){var a="#000";return Ne(e[1]).luminance()<.4&&(a="#fff"),[e[0],e[1],a]}))}}),(function(e,t){return{dispatchPickLegend:function(t){e(ue({breaks:q[t]}))}}}))(ga),ba=(a(350),a(351),a(352),G.map((function(e){return e[0]}))),va=function(e){Object(Be.a)(a,e);var t=Object(Ve.a)(a);function a(e){var n;return Object(ze.a)(this,a),(n=t.call(this,e)).state={features:[]},n}return Object(Ke.a)(a,[{key:"componentDidMount",value:function(){this.props.loadingMap(),this.loadMap()}},{key:"componentWillReceiveProps",value:function(e){this.updateMapStyle(e.mapStyle)}},{key:"setTooltip",value:function(e){e.length?c.a.render(l.a.createElement(ma,{features:e}),this.tooltipContainer):c.a.unmountComponentAtNode(this.tooltipContainer)}},{key:"makeTooltipOnHover",value:function(e,t){if(void 0!==e){var a=this.webmap.queryRenderedFeatures(e.point,{layers:["HOVER-pixel","HOVER-gauge"]});t.setLngLat(e.lngLat),this.webmap.getCanvas().style.cursor=a.length?"pointer":"",this.setTooltip(a),this.setState({features:a})}}},{key:"handleMapClick",value:function(e){var t=this,a=[[e.point.x-1,e.point.y-1],[e.point.x+1,e.point.y+1]],n=this.webmap.queryRenderedFeatures(a,{layers:ba}),r={};n.length>0&&(n.forEach((function(e){var t=Ye(e);Object(O.a)(r,e.source)?r[e.source].push(t):r[e.source]=[t]})),Object(w.a)(r,(function(e,a){t.props.makeChoiceOnMapClick({sensorLocationType:a,selectedOptions:e})})))}},{key:"loadMap",value:function(){var e=this,t={container:"map",style:this.props.initMap.mapboxSources["3rww-rainfall-base"].url,center:[this.props.initMap.longitude,this.props.initMap.latitude],zoom:this.props.zoom,attributionControl:!1};It.a.accessToken=this.props.token,this.webmap=new It.a.Map(t),this.tooltipContainer=document.createElement("div");var a=new It.a.Marker(this.tooltipContainer,{offset:[105,0]}).setLngLat([0,0]).addTo(this.webmap);this.webmap.on("load",(function(){e.webmap.addControl(new _t.a({accessToken:It.a.accessToken,mapboxgl:It.a,placeholder:"Fly me to...",marker:!1,collapsed:!0,clearAndBlurOnEsc:!0,clearOnBlur:!0,countries:"us"})),e.webmap.addControl(new It.a.NavigationControl),e.webmap.addControl(new It.a.AttributionControl({compact:!0,customAttribution:e.props.initMap.attribution})),e.props.initMap.sourcesToAdd.forEach((function(t){e.webmap.addSource(t.sourceName,t.sourceData)})),e.props.initMap.layersToAdd.forEach((function(t){t.layerStyles.forEach((function(a){e.webmap.addLayer(a,t.addLayerStylesAbove)}))}));var t=e.webmap.getStyle();e.props.setStyle(t),e.props.mapLoaded(e.webmap.loaded()),e.props.initFetchData()})),this.webmap.on("click",(function(t){return e.handleMapClick(t)}));var n={};G.forEach((function(t){var r=t[0],o=t[1];n[r]=null,e.webmap.on("mousemove",r,(function(t){e.makeTooltipOnHover(t,a),e.webmap.getCanvas().style.cursor=t.features.length?"pointer":"",t.features.length>0&&(n[r]&&e.webmap.setFeatureState({source:o,id:n[r]},{hover:!1}),n[r]=t.features[0].id,e.webmap.setFeatureState({source:o,id:n[r]},{hover:!0}))})),e.webmap.on("mouseleave",r,(function(t){e.makeTooltipOnHover(t,a),e.webmap.getCanvas().style.cursor="",n[r]&&e.webmap.setFeatureState({source:o,id:n[r]},{hover:!1}),n[r]=null}))}))}},{key:"updateMapStyle",value:function(e){if(null!==this.props.mapStyle&&!Object(fe.a)(this.props.mapStyle)){var t=this.webmap,a=Nt.a.fromJS(this.props.mapStyle),n=Nt.a.fromJS(e);if(!Nt.a.is(a,n)){var r=sa(a.toJS(),n.toJS());console.log("updating mapStyle (".concat(r.map((function(e){return e.command})),")")),r.forEach((function(e){if("setGeoJSONSourceData"==e.command){var a=t.getSource(e.args[0]);a&&a.setData(e.args[1])}else t[e.command].apply(t,e.args)}))}}}},{key:"render",value:function(){return l.a.createElement("div",{className:"map-and-legend-container"},l.a.createElement("div",{className:"map",id:"map"}),l.a.createElement("div",{className:"legend-container container-fluid"},l.a.createElement(ya,null)))}}]),a}(o.Component);var Ea=Object(s.b)((function(e){return{mapStyle:e.mapStyle,initMap:e.initMap}}),(function(e,t){return{loadingMap:function(t){e(U("Loading the map"))},setStyle:function(t){e(z(t))},mapLoaded:function(t){e(W(t)),e(Z("Map loaded"))},initFetchData:function(t){return e(Et())},makeChoiceOnMapClick:function(a){e(xt(Object(m.a)({contextType:t.activeTab},a)))}}}))(va),Oa=a(396),wa=a(206),ja=a(397),xa=a(207),Ta=a.n(xa),ka=a(106),Da=a(107),Ca=a(395),Sa=(a(356),function(e){Object(Be.a)(a,e);var t=Object(Ve.a)(a);function a(e){var n;return Object(ze.a)(this,a),(n=t.call(this,e)).handleListClick=n.handleListClick.bind(Object(Je.a)(n)),n}return Object(Ke.a)(a,[{key:"handleListClick",value:function(e){this.props.dispatchPickRainfallEvent(e.eventid)}},{key:"render",value:function(){var e=this;return l.a.createElement(Qe.a,null,l.a.createElement(Ue.a,null,l.a.createElement(ua.a,{variant:"flush"},this.props.events.map((function(t,a){var n=g()(t.startDt),r=g()(t.endDt),o=t.hours/48*100;return l.a.createElement(ua.a.Item,{action:!0,onClick:function(){return e.handleListClick(t)},key:a,eventKey:t.eventid,className:"event-list-item"},l.a.createElement("small",null,l.a.createElement(Qe.a,null,l.a.createElement(Ue.a,{xs:7},n.format("DD MMM YYYY, h:mm a")," \u2014 ",r.format("DD MMM YYYY, h:mm a"),"\xa0"),l.a.createElement(Ue.a,{xs:5},t.hours," hour",t.hours>1?"s":""))),l.a.createElement(Qe.a,null,l.a.createElement(Ue.a,null,l.a.createElement(Ca.a,{className:"event-length-bar",now:o,variant:"primary"}))))})))))}}]),a}(l.a.Component));var Aa=Object(s.b)((function(e){var t=De(e);return{events:t.list.filter((function(e){return t.filters.maxHours>=24||e.hours<=t.filters.maxHours?e:void 0})),maxHours:parseFloat(t.stats.longest)}}),(function(e,t){return{dispatchPickRainfallEvent:function(a){e(ee({eventid:a,contextType:t.contextType}))}}}))(Sa),Na=(a(357),a(358),function(e){Object(Be.a)(a,e);var t=Object(Ve.a)(a);function a(e){var n;return Object(ze.a)(this,a),(n=t.call(this)).handleOnApply=n.handleOnApply.bind(Object(Je.a)(n)),n.handleShow=n.handleShow.bind(Object(Je.a)(n)),n.handleClose=n.handleClose.bind(Object(Je.a)(n)),n.state={show:!1},n}return Object(Ke.a)(a,[{key:"handleOnApply",value:function(e,t){this.props.dispatchPickRainfallDateTimeRange({startDt:t.startDate.toISOString(),endDt:t.endDate.toISOString()})}},{key:"handleClose",value:function(e){this.setState({show:!1})}},{key:"handleShow",value:function(e){this.setState({show:!0})}},{key:"render",value:function(){return l.a.createElement("div",null,l.a.createElement(et.a,{show:this.state.show,onHide:this.handleClose,size:"lg"},l.a.createElement(et.a.Header,{closeButton:!0},l.a.createElement(et.a.Title,null,"Select A Rainfall Event")),l.a.createElement(et.a.Body,null,l.a.createElement(Aa,{contextType:this.props.contextType,handleClose:this.handleClose})),l.a.createElement(et.a.Footer,null,l.a.createElement(tt.a,{variant:"secondary",onClick:this.handleClose},"Close"))),l.a.createElement(Qe.a,{noGutters:!0},l.a.createElement(Ue.a,null,l.a.createElement("strong",null,"When"))),l.a.createElement(Qe.a,{noGutters:!0},l.a.createElement(Ue.a,null,!1!==this.props.startDt&&!1!==this.props.endDt?l.a.createElement(Oa.a,{className:"datetimepicker-control"},l.a.createElement(wa.a,{plaintext:!0,readOnly:!0,placeholder:"start and end date/times",value:"".concat(this.props.startDt.format("MM/DD/YYYY hh:mm A")," to ").concat(this.props.endDt.format("MM/DD/YYYY hh:mm A")),"aria-label":"start and end dates",className:"datetimepicker-control"}),l.a.createElement(Oa.a.Append,null,l.a.createElement(Ta.a,{id:"dtp-show-daterangepicker-".concat(this.props.rainfallDataType),startDate:this.props.startDt,endDate:this.props.endDt,maxDate:this.props.maxDate,timePicker:!0,timePickerIncrement:15,showDropdowns:!1,ranges:this.props.ranges,alwaysShowCalendars:!0,onApply:this.handleOnApply},l.a.createElement(tt.a,{variant:"light",className:"datetimepicker-control"},l.a.createElement(ka.a,{icon:Da.a}))),this.props.rainfallDataType===S?l.a.createElement(tt.a,{id:"dtp-show-eventlistmodal",variant:"light",onClick:this.handleShow,className:"datetimepicker-control"},l.a.createElement(ka.a,{icon:Da.c})):null)):l.a.createElement(ja.a,{animation:"border",variant:"primary",size:"sm"},l.a.createElement("span",{className:"sr-only"},'"Fetching historic ranges...')))))}}]),a}(l.a.Component));var La=Object(s.b)((function(e,t){var a=ye(e,t.contextType),n=g()(a.startDt),r=g()(a.endDt),o=!1,l={};if(o="legacyGarr"===t.contextType?Ae(e):"legacyGauge"===t.contextType?Se(e):g()().toISOString(),t.rainfallDataType===S)l={"Latest month":[g()(o).startOf("month"),g()(o)],"Latest 3 months":[g()(o).subtract(2,"month").startOf("month"),g()(o)],"Latest 6 months":[g()(o).subtract(5,"month").startOf("month"),g()(o)],"Latest 12 months":[g()(o).subtract(11,"month").startOf("month"),g()(o)],"Latest Available This Year":[g()(o).startOf("year"),g()(o)],"Last Year":[g()(o).subtract(1,"year").startOf("year"),g()(o).subtract(1,"year").endOf("year")]};else if(t.rainfallDataType===A){var i=g()().toISOString();l={"Past 2 hours":[g()(i).subtract(2,"hour"),g()(i)],"Past 4 hours":[g()(i).subtract(4,"hour"),g()(i)],"Past 6 hours":[g()(i).subtract(6,"hour"),g()(i)],"Past 12 hours":[g()(i).subtract(12,"hour"),g()(i)],"Past 24 hours":[g()(i).subtract(24,"hour"),g()(i)],"Past 48 hours":[g()(i).subtract(48,"hour"),g()(i)],Today:[g()(i).startOf("day"),g()(i)],Yesterday:[g()(i).subtract(1,"day").startOf("day"),g()(i).subtract(1,"day").endOf("day")],"Past 3 days":[g()(i).subtract(3,"day").startOf("day"),g()(i)],"Past 7 days":[g()(i).subtract(7,"day").startOf("day"),g()(i)],"Past month":[g()(i).subtract(1,"month").startOf("day"),g()(i)],"Past 3 months":[g()(i).subtract(3,"month").startOf("month"),g()(i)]}}else o=!1,n=!1,r=!1,l={};return{local:{format:"MM/DD/YYYY hh:mm A"},startDt:n,endDt:r,minDate:g()(C),maxDate:g()(o),minYear:g()(C).year(),maxYear:g()().year(),ranges:l,rainfallDataType:t.rainfallDataType}}),(function(e,t){return{dispatchPickRainfallDateTimeRange:function(a){e(te(Object(m.a)(Object(m.a)({},a),{},{contextType:t.contextType})))}}}))(Na),Ia=a(398),Ra=a(156),_a=function(e){Object(Be.a)(a,e);var t=Object(Ve.a)(a);function a(e){var n;return Object(ze.a)(this,a),(n=t.call(this)).handleOnApply=n.handleOnApply.bind(Object(Je.a)(n)),n.handleShow=n.handleShow.bind(Object(Je.a)(n)),n.handleClose=n.handleClose.bind(Object(Je.a)(n)),n.state={show:!1},n}return Object(Ke.a)(a,[{key:"handleOnApply",value:function(){}},{key:"handleClose",value:function(e){this.setState({show:!1})}},{key:"handleShow",value:function(e){this.setState({show:!0})}},{key:"render",value:function(){var e=this.props.gaugeCount,t=this.props.pixelCount;return l.a.createElement("div",null,l.a.createElement(Qe.a,{noGutters:!0,className:"mb-2"},l.a.createElement(Ue.a,null,l.a.createElement("strong",null,"Where"),e>0?l.a.createElement("span",{className:"mx-1 my-1"},l.a.createElement(Ia.a,{pill:!0,variant:"primary"},"".concat(e," ").concat(da(e,"gauge","gauges")))):null,t>0?l.a.createElement("span",{className:"mx-1 my-1"},l.a.createElement(Ia.a,{pill:!0,variant:"primary"},"".concat(t," ").concat(da(t,"pixel","pixels")))):null)),l.a.createElement(Qe.a,{noGutters:!0},l.a.createElement(Ue.a,null,l.a.createElement(at.a,{defaultActiveKey:"sensor",id:"geomPickerTypes"},l.a.createElement(nt.a,{eventKey:"sensor",title:"By Sensor",className:"my-4"},this.props.context!==R?l.a.createElement(Qe.a,{noGutters:!0},l.a.createElement(Ue.a,{md:3},l.a.createElement("small",null,"Rain Gauges")),l.a.createElement(Ue.a,{md:9},l.a.createElement(Ra.a,{isMulti:!0,value:this.props.selectedGauges,onChange:this.props.handleSelectGauge,options:this.props.gaugeOpts,menuPortalTarget:document.body,isClearable:!0}))):null,this.props.context!==I?l.a.createElement(Qe.a,{noGutters:!0},l.a.createElement(Ue.a,{md:3},l.a.createElement("small",null,"Radar Pixels")),l.a.createElement(Ue.a,{md:9},l.a.createElement(Ra.a,{isMulti:!0,value:this.props.selectedPixels,onChange:this.props.handleSelectPixel,options:this.props.pixelOpts,menuPortalTarget:document.body,isClearable:!0}))):null),l.a.createElement(nt.a,{eventKey:"geography",title:"By Geography",className:"my-4"},l.a.createElement(Qe.a,{noGutters:!0},l.a.createElement(Ue.a,{md:12},l.a.createElement(Ra.a,{placeholder:"Select radar pixels by basin, municipality, or watershed",isMulti:!0,onChange:this.props.handleSelectGeography,options:this.props.geographyOpts,menuPortalTarget:document.body,isClearable:!0}))))))))}}]),a}(l.a.Component);var Pa=Object(s.b)((function(e,t){var a=ge(e),n=Te(e,"pixel").map((function(e){return{value:e.properties.id,label:"".concat(e.properties.id)}})),r=Oe(e,t.contextType,"pixel"),o=Te(e,"gauge").filter((function(e){return!0===e.properties.active})).map((function(e){return{value:e.properties.id,label:"".concat(e.properties.id,": ").concat(e.properties.name)}})),l=Oe(e,t.contextType,"gauge");return{gaugeOpts:o,pixelOpts:n,geographyOpts:function(e){var t=Object(j.a)(e,"refData.lookups",{});return Object(v.a)(t).map((function(e){return{label:e,options:Object(v.a)(t[e]).map((function(t){return{value:"".concat(e,".").concat(t),label:t}}))}}))}(e),selectedBasin:Oe(e,t.contextType,"basin"),selectedGauges:l,selectedPixels:r,pixelCount:r.length,gaugeCount:l.length,context:a}}),(function(e,t){return{handleSelectGauge:function(a){e(xt({contextType:t.contextType,inputType:"geomPicker",sensorLocationType:"gauge",selectedOptions:a}))},handleSelectPixel:function(a){e(xt({contextType:t.contextType,inputType:"geomPicker",sensorLocationType:"pixel",selectedOptions:a}))},handleSelectGeography:function(a){e(function(e){var t=We.getState(),a=e.selectedOptions,n=(e.sensorLocationType,e.contextType),r=e.inputType;return function(){var o=Object(ut.a)(bt().mark((function o(l){return bt().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:xt(e,!1),["pixel"].forEach((function(e){var o=new Set;null===a&&0===Object(j.a)(a,"length",0)||a.forEach((function(a,n){var r=ke(t,a.value);Object(j.a)(r,e,[]).forEach((function(e){return o.add(e.toString())}))}));var i=Object(h.a)(o),c=Te(t,e).filter((function(e){return Object(b.a)(i,e.properties.id)})).map((function(e){return Ye(e)}));l(xt({contextType:n,sensorLocationType:e,selectedOptions:c,inputType:r}))}));case 3:case"end":return o.stop()}}),o)})));return function(e){return o.apply(this,arguments)}}()}({contextType:t.contextType,inputType:"geomPicker",sensorLocationType:"geography",selectedOptions:a}))}}}))(_a),Ga=function(e){Object(Be.a)(a,e);var t=Object(Ve.a)(a);function a(){var e;Object(ze.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).handleSelectInterval=function(t){e.props.dispatchPickInterval(t.currentTarget.value)},e}return Object(Ke.a)(a,[{key:"render",value:function(){var e=this;return l.a.createElement(Qe.a,{noGutters:!0},l.a.createElement(Ue.a,{lg:3},l.a.createElement("strong",null,"Interval")),l.a.createElement(Ue.a,{lg:9},l.a.createElement(fa.a,null,D.map((function(t,a){return l.a.createElement(fa.a.Check,{defaultChecked:"15-minute"==t,inline:!0,key:"interval-".concat(t,"-").concat(a,"-").concat(e.props.rainfallDataType),label:t,value:t,type:"radio",id:"interval-".concat(t,"-").concat(e.props.rainfallDataType),name:"intervalRadios",onChange:e.handleSelectInterval})})))))}}]),a}(l.a.Component);var Ma=Object(s.b)((function(e){return{}}),(function(e,t){return{dispatchPickInterval:function(a){e(ne({rollup:a,contextType:t.contextType}))}}}))(Ga),Ha=a(399),Ya=a(208),qa=a(209),Fa=function(e){var t=e.rows,a=e.header,n=t.map((function(e,t){return l.a.createElement("tr",{key:"r".concat(t)},a.map((function(a,n){return l.a.createElement("td",{key:"d".concat(t).concat(n)},l.a.createElement("small",null,e[a]))})))}));return n.push(l.a.createElement("tr",{key:"r---}"},a.map((function(e,t){return l.a.createElement("td",{key:"d---".concat(t)},l.a.createElement("small",null,"..."))})))),l.a.createElement(ha.a,{responsive:!0,striped:!0,bordered:!0,hover:!0,size:"sm",className:"download-table"},l.a.createElement("thead",null,l.a.createElement("tr",{className:"download-table-header"},a.map((function(e,t){return l.a.createElement("th",{key:"h".concat(t)},l.a.createElement("small",null,l.a.createElement("em",null,_[e])))})))),l.a.createElement("tbody",null,n))},Wa=function(e){Object(Be.a)(a,e);var t=Object(Ve.a)(a);function a(e){var n;return Object(ze.a)(this,a),(n=t.call(this)).handleDownloadClick=n.handleDownloadClick.bind(Object(Je.a)(n)),n}return Object(Ke.a)(a,[{key:"handleDownloadClick",value:function(e){e.preventDefault();var t=new Blob([this.props.csv],{type:"application/csv"});Object(qa.saveAs)(t,"rainfall.csv",{autoBom:!0})}},{key:"render",value:function(){var e=this.props.fetchHistoryItem.fetchKwargs,t=e.sensorLocations,a=t.gauge,n=t.pixel;return l.a.createElement(et.a,{show:this.props.show,onHide:this.props.onHide,size:"lg",dialogClassName:"min-vw-95",animation:!1},l.a.createElement(et.a.Header,{closeButton:!0},l.a.createElement(et.a.Title,null,l.a.createElement(Qe.a,null,l.a.createElement(Ue.a,null,l.a.createElement("h4",null,g()(e.startDt).format("DD MMM YYYY, h:mm a")," to ",g()(e.endDt).format("DD MMM YYYY, h:mm a")),l.a.createElement("hr",null))),a.length>0?l.a.createElement(Qe.a,null,l.a.createElement(Ue.a,{md:3},l.a.createElement("small",null,"Gauges:")),l.a.createElement(Ue.a,{md:9},l.a.createElement("small",null,a.map((function(e){return e.label})).join(", ")))):null,n.length>0?l.a.createElement(Qe.a,null,l.a.createElement(Ue.a,{md:3},l.a.createElement("small",null,"Pixels:")),l.a.createElement(Ue.a,{md:9},l.a.createElement("small",null,n.length," pixels queried"))):null,l.a.createElement(Qe.a,null,l.a.createElement(Ue.a,{md:3},l.a.createElement("small",null,"Interval:")),l.a.createElement(Ue.a,{md:9},l.a.createElement("small",null,e.rollup))))),l.a.createElement(et.a.Body,null,l.a.createElement(at.a,{defaultActiveKey:"results-table",id:"results-types",variant:"pills",mountOnEnter:!0},l.a.createElement(nt.a,{eventKey:"results-table",title:"Table",className:"my-3"},l.a.createElement(Qe.a,null,l.a.createElement(Ue.a,{sm:3},l.a.createElement("p",null,"Download as: ")),l.a.createElement(Ue.a,{sm:3},l.a.createElement(tt.a,{block:!0,variant:"outline-primary",size:"sm",onClick:this.handleDownloadClick},"CSV"))),l.a.createElement(Qe.a,null,l.a.createElement(Ue.a,null,l.a.createElement("p",{className:"small"},l.a.createElement("em",null,"".concat(this.props.rows.length," total records, showing ").concat(50))),l.a.createElement(Fa,{rows:this.props.rows.slice(0,50),header:this.props.header}),l.a.createElement("p",{className:"small"},l.a.createElement("em",null))))),l.a.createElement(nt.a,{eventKey:"results-graph",title:"Graph",className:"my-3"},l.a.createElement("p",{className:"small"},l.a.createElement("em",null,"Coming soon: results in an interactive graph"))))),l.a.createElement(et.a.Footer,null,l.a.createElement(tt.a,{variant:"outline-secondary",onClick:this.props.onHide},"Close")))}}]),a}(l.a.Component),za=Object(s.b)((function(e,t){var a=t.fetchHistoryItem.results,n=[];return Object(v.a)(a).forEach((function(e){a[e].forEach((function(t){var a=t.data.map((function(a){return Object(m.a)(Object(m.a)({},a),{},{id:t.id,type:e})}));n=n.concat(a)}))})),{header:n.length>0?Object(v.a)(n[0]):[],rows:n.length>0?n:[],csv:n.length>0?Object(Ya.unparse)(n):""}}))(Wa),Ka=(a(377),function(e){Object(Be.a)(a,e);var t=Object(Ve.a)(a);function a(e,n){var r;return Object(ze.a)(this,a),(r=t.call(this,e,n)).handleShow=r.handleShow.bind(Object(Je.a)(r)),r.handleClose=r.handleClose.bind(Object(Je.a)(r)),r.state={show:!1},r}return Object(Ke.a)(a,[{key:"handleClose",value:function(e){this.setState({show:!1})}},{key:"handleShow",value:function(e){this.setState({show:!0}),this.props.fetchHistoryItem.isActive||(console.log(e),console.log("Loading data from",this.props.fetchHistoryItem.requestId,"to the map"),this.props.dispatchPickDownload())}},{key:"render",value:function(){var e=this.props.fetchHistoryItem,t=e.fetchKwargs,a=t.sensorLocations,n=a.gauge,r=a.pixel,o=!1!==e.results,i=e.processedKwargs,c=Object(b.a)(["deferred","failed","does not exist","error"],e.status);return l.a.createElement("div",{className:"download-item-wrapper"},l.a.createElement(Qe.a,null,l.a.createElement(Ue.a,{sm:12},l.a.createElement(rt.a.Title,null,g()(t.startDt).format("DD MMM YYYY, h:mm a")," to ",g()(t.endDt).format("DD MMM YYYY, h:mm a")),l.a.createElement("hr",null))),n.length>0?l.a.createElement(Qe.a,null,l.a.createElement(Ue.a,{lg:3},l.a.createElement("p",{className:"di-header"},"Gauges:")),l.a.createElement(Ue.a,{lg:9},l.a.createElement("p",null,n.map((function(e){return e.label})).join(", ")))):null,r.length>0?l.a.createElement(Qe.a,null,l.a.createElement(Ue.a,{lg:3},l.a.createElement("p",{className:"di-header"},"Pixels:")),l.a.createElement(Ue.a,{lg:9},l.a.createElement("p",null,r.length," pixels queried"))):null,l.a.createElement(Qe.a,null,l.a.createElement(Ue.a,{lg:3},l.a.createElement("p",{className:"di-header"},"Aggregation:")),l.a.createElement(Ue.a,{lg:9},l.a.createElement("p",null,t.rollup))),void 0===i?null:l.a.createElement(Qe.a,null,l.a.createElement(Ue.a,{lg:3},l.a.createElement("p",{className:"di-header"},"Date/time range queried:")),l.a.createElement(Ue.a,{lg:9},l.a.createElement("p",null,i.start_dt,"/",i.end_dt))),o?l.a.createElement(Qe.a,null,l.a.createElement(Ue.a,null,l.a.createElement(tt.a,{variant:"outline-primary",size:"sm",onClick:this.handleShow},"View and Download Results Table"))):null,c?e.messages.map((function(e,t){return l.a.createElement(Ha.a,{dismissible:!0,key:t,variant:"danger"},l.a.createElement("small",null,e))})):null,l.a.createElement(za,{show:this.state.show,onHide:this.handleClose,fetchHistoryItem:this.props.fetchHistoryItem}))}}]),a}(l.a.Component)),Ba=Object(s.b)((function(e,t){return Object(m.a)({},t)}),(function(e,t){return{dispatchPickDownload:function(a){var n=Object(m.a)(Object(m.a)({},t.fetchHistoryItem),{},{contextType:t.contextType});e(wt(n))}}}))(Ka),Va=(a(378),function(e){Object(Be.a)(a,e);var t=Object(Ve.a)(a);function a(e,n){var r;return Object(ze.a)(this,a),(r=t.call(this,e,n)).handleListClick=r.handleListClick.bind(Object(Je.a)(r)),r}return Object(Ke.a)(a,[{key:"handleListClick",value:function(e){this.props.pickDownload(e)}},{key:"render",value:function(){var e=this;return l.a.createElement(ua.a,{variant:"flush"},this.props.fetchHistory.slice(0).reverse().map((function(t,a){var n,r=Object(b.a)(["deferred","failed","does not exist","error"],t.status);return n=t.isActive&&"finished"===t.status?"primary":r?"danger":"",l.a.createElement(ua.a.Item,{key:a,as:"div",className:"mx-0",action:!0,onClick:function(){return e.handleListClick(t)},variant:n},l.a.createElement(Qe.a,{noGutters:!0},l.a.createElement(Ue.a,{sm:t.isFetching?11:12},l.a.createElement(Ba,{fetchHistoryItem:t,contextType:e.props.contextType,rainfallDataType:e.props.rainfallDataType,rainfallSensorType:e.props.rainfallSensorType})),t.isFetching?l.a.createElement(Ue.a,{sm:1},l.a.createElement(ja.a,{animation:"border",variant:"primary"},l.a.createElement("span",{className:"sr-only"},'"Fetching rainfall data...'))):null))})))}}]),a}(l.a.Component)),Xa=Object(s.b)((function(e,t){var a=be(e,t.contextType);return{fetchHistory:a,hasDownloads:a.length>0,rainfallDataType:t.rainfallDataType}}),(function(e,t){return{pickDownload:function(a){e(wt(Object(m.a)(Object(m.a)({},a),{},{contextType:t.contextType})))}}}))(Va),Ja=(a(379),function(e){Object(Be.a)(a,e);var t=Object(Ve.a)(a);function a(e){var n;return Object(ze.a)(this,a),(n=t.call(this)).handleDownloadClick=n.handleDownloadClick.bind(Object(Je.a)(n)),n}return Object(Ke.a)(a,[{key:"handleDownloadClick",value:function(){this.props.fetchRainfallData({rainfallDataType:this.props.rainfallDataType,contextType:this.props.contextType})}},{key:"render",value:function(){return l.a.createElement("div",null,l.a.createElement(rt.a,null,l.a.createElement(rt.a.Body,null,l.a.createElement(La,{rainfallDataType:this.props.rainfallDataType,contextType:this.props.contextType}),l.a.createElement("hr",null),l.a.createElement(Pa,{rainfallDataType:this.props.rainfallDataType,contextType:this.props.contextType}),l.a.createElement("hr",null),l.a.createElement(Ma,{rainfallDataType:this.props.rainfallDataType,contextType:this.props.contextType}),l.a.createElement("hr",null),l.a.createElement(tt.a,{onClick:this.handleDownloadClick,disabled:!this.props.hasKwargs,block:!0},"Get Rainfall Data"))),l.a.createElement("br",null),this.props.hasDownloads?l.a.createElement(rt.a,null,l.a.createElement(rt.a.Header,null,"Retrieved Rainfall Data"),l.a.createElement(Xa,{contextType:this.props.contextType,rainfallDataType:this.props.rainfallDataType})):null)}}]),a}(l.a.Component));var Qa=Object(s.b)((function(e,t){var a=function(e,t){var a={};return Object(w.a)(ye(e,t).sensorLocations,(function(e,t){e.length>0&&(a[t]=e)})),a}(e,t.contextType),n=be(e,t.contextType);return{hasKwargs:!Object(fe.a)(a),hasDownloads:n.length>0}}),(function(e,t){return{fetchRainfallData:function(t){e(Ot(t))}}}))(Ja),Ua=a(408),Za=a(401),$a=(a(197),l.a.createElement(Ua.a,{id:"popover-basic"},l.a.createElement(Ua.a.Title,{as:"h3"},"Provisional Data Disclaimer"),l.a.createElement(Ua.a.Content,null,"Data shown here are provisional and subject to revision until they have been thoroughly reviewed and received final approval. Current condition data relayed by satellite or other telemetry are automatically screened to not display improbable values until they can be verified. Provisional data may be inaccurate due to instrument malfunctions or physical changes at the measurement site. Subsequent review based on field inspections and measurements may result in significant revisions to the data. Data users are cautioned to consider carefully the provisional nature of the information before using it for decisions that concern personal or public safety or the conduct of business that involves substantial monetary or operational consequences. Information concerning the accuracy and appropriate uses of these data or concerning other hydrologic data may be obtained from the 3RWW."))),en=function(e){Object(Be.a)(a,e);var t=Object(Ve.a)(a);function a(){return Object(ze.a)(this,a),t.apply(this,arguments)}return Object(Ke.a)(a,[{key:"render",value:function(){return l.a.createElement(Qe.a,null,l.a.createElement(Ue.a,null,l.a.createElement("h1",{className:"data-type-header"},"Get Real-time Rainfall Data"),l.a.createElement("p",null,"Download real-time, provisional rainfall measurements are available from the rain gauge network and NEXRAD radar. This data is updated every 15 minutes.",l.a.createElement("small",{className:"my-3"},l.a.createElement(Za.a,{trigger:"click",placement:"bottom",overlay:$a},l.a.createElement(tt.a,{variant:"light",size:"sm"},"Provisional Data Disclaimer"))))))}}]),a}(l.a.Component),tn=(a(380),function(e){Object(Be.a)(a,e);var t=Object(Ve.a)(a);function a(){return Object(ze.a)(this,a),t.apply(this,arguments)}return Object(Ke.a)(a,[{key:"render",value:function(){return this.props.isAppThinking?l.a.createElement("div",{className:"thinking-overlay"},l.a.createElement("div",{className:"d-flex thinking-content"},l.a.createElement("span",{className:"fa-layers fa-fw"},l.a.createElement(ka.a,{icon:Da.d,pulse:!0,size:"8x"}),l.a.createElement(ka.a,{icon:Da.b,size:"4x",transform:"right-8"}))),l.a.createElement("p",{className:"debug-messages"},this.props.message)):null}}]),a}(l.a.Component));var an=Object(s.b)((function(e){var t=e.progress.messages;return{isAppThinking:e.progress.isThinking>0,message:t[t.length-1]}}))(tn),nn=function(e){Object(Be.a)(a,e);var t=Object(Ve.a)(a);function a(){return Object(ze.a)(this,a),t.apply(this,arguments)}return Object(Ke.a)(a,[{key:"render",value:function(){return l.a.createElement("div",{className:"fill no-gutters"},l.a.createElement(an,null),l.a.createElement(Qe.a,null,l.a.createElement(Ue.a,null)),l.a.createElement(Qe.a,{className:"fill no-gutters"},l.a.createElement(Ue.a,{sm:7,className:"map-column"},l.a.createElement(Ea,{activeTab:this.props.tab,token:this.props.token,styleUrl:this.props.styleId,latitude:this.props.latitude,longitude:this.props.longitude,zoom:this.props.zoom})),l.a.createElement(Ue.a,{sm:5,className:"sidebar-column"},l.a.createElement(Ct.a,{className:"sidebar mt-3"},l.a.createElement(St.a,null,l.a.createElement(At.a,{active:this.props.tab===L,eventKey:L,title:"Real-Time Rainfall"},l.a.createElement(en,null),l.a.createElement(Qa,{contextType:L,rainfallDataType:A,rainfallSensorTypes:[N.gauge,N.pixel]})),l.a.createElement(At.a,{active:this.props.tab===I,eventKey:I,title:"Historical Rain Gauge"},l.a.createElement("h1",{className:"data-type-header"},"Get Historical Rain Gauge Data"),l.a.createElement("p",null,"Download historic rain gauge data, which has been through a QA/QC process with ALCOSAN and 3RWW, during which any data errors caused by the gauge hardware have been addressed."),l.a.createElement(Qa,{contextType:I,rainfallDataType:S,rainfallSensorTypes:[N.gauge]})),l.a.createElement(At.a,{active:this.props.tab===R,eventKey:R,title:"Calibrated Radar Rainfall"},l.a.createElement("h1",{className:"data-type-header"},"Get Calibrated Radar Rainfall Data"),l.a.createElement("p",null,"Download calibrated radar rainfall data, which is NEXRAD radar rainfall data adjusted using 3RWW's rain gauge network. Calibration is performed by ",l.a.createElement("a",{href:"https://www.vieuxinc.com/",target:"_blank"},"Vieux Associates"),"."),l.a.createElement(Qa,{contextType:R,rainfallDataType:S,rainfallSensorTypes:[N.pixel]})))))))}}]),a}(l.a.Component);var rn={switchContext:jt},on=Object(s.b)((function(e){return Object(m.a)(Object(m.a)({},e.initMap),{},{tab:e.progress.tab})}),rn)(nn),ln=function(e){Object(Be.a)(a,e);var t=Object(Ve.a)(a);function a(){return Object(ze.a)(this,a),t.apply(this,arguments)}return Object(Ke.a)(a,[{key:"render",value:function(){return l.a.createElement("div",{style:{height:"100%"}},l.a.createElement(Xe.a,{defaultActiveKey:L,id:"rainfall-tabs",onSelect:this.props.switchContext},l.a.createElement(Dt,{isloading:this.props.loading}),l.a.createElement(on,null)))}}]),a}(l.a.Component);var cn=Object(s.b)((function(e){return Object(m.a)({},e.initMap)}),(function(e,t){return{switchContext:function(t){console.log("switching",t),e(jt(t))}}}))(ln);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));console.log("Hello there curious person! The 3RWW Rainfall API is located at","https://trwwapi.herokuapp.com/rainfall/","- check it out for more powerful querying capability!"),c.a.render(l.a.createElement(s.a,{store:We},l.a.createElement(cn,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[210,1,2]]]);
//# sourceMappingURL=main.66d12cae.chunk.js.map