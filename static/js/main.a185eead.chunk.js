(this["webpackJsonp3rww-rainfall-viz"]=this["webpackJsonp3rww-rainfall-viz"]||[]).push([[0],{321:function(e,t,a){},339:function(e,t,a){e.exports=a(746)},549:function(e,t,a){},550:function(e,t,a){},667:function(e,t){},702:function(e,t,a){},731:function(e,t,a){},734:function(e,t,a){},738:function(e,t,a){},740:function(e,t,a){},741:function(e,t,a){},742:function(e,t,a){},743:function(e,t,a){},745:function(e,t,a){},746:function(e,t,a){"use strict";a.r(t);a(340);var n,r,o=a(0),l=a.n(o),i=a(26),s=a.n(i),c=a(15),u=a(11),d=a(9),p=a(112),h=a(12),m=a(72),f=a(7),b=a.n(f),g=a(780),y=a(70),v=a(762),E=a(767),O=a(768),j=a(773),w=a(779),T=window.location.href,D=T+"static/data/events.json",x=T+"static/data/pixels.geojson",k=T+"static/data/gauges.geojson",S=T+"static/data/basin-lookup-pixel.json",C=["15-minute","Hourly","Daily","Total"],A="".concat("2000-04-01"),I="historic",R="realtime",N={pixel:"pixel",gauge:"gauge"},L="legacyRealtime",P="legacyGauge",_="legacyGarr",M={ts:"timestamp",val:"rainfall",src:"source",id:"sensor id",type:"sensor type"},H=[{INDEX:69,id:"pixel-results",type:"fill",source:"pixel",layout:{},paint:{"fill-color":["match",["get","total"],"","#fff",["interpolate",["linear"],["get","total"],0,"#fafa6e",10,"#2A4858"]],"fill-opacity":["match",["get","total"],"",0,.8]}},{INDEX:70,id:"".concat("HOVER","-pixel"),type:"fill",source:"pixel",layout:{},paint:{"fill-color":"#2196f3","fill-opacity":["case",["boolean",["feature-state","hover"],!1],.25,0]}},{INDEX:71,id:"".concat("HOVER","-gauge-halo"),type:"circle",source:"gauge",layout:{},paint:{"circle-radius":20,"circle-color":"#2196f3","circle-blur":.8,"circle-opacity":["case",["boolean",["feature-state","hover"],!1],.8,0]}},{INDEX:72,id:"".concat("HOVER","-gauge"),type:"circle",source:"gauge",layout:{},paint:{"circle-radius":["interpolate",["linear"],["zoom"],7,6,18,12],"circle-color":"hsl(209, 25%, 55%)","circle-stroke-color":"#fff","circle-stroke-width":2,"circle-opacity":["case",["boolean",["feature-state","hover"],!1],1,0],"circle-stroke-opacity":["case",["boolean",["feature-state","hover"],!1],1,0]}},{id:"gauge-results",type:"circle",source:"gauge",layout:{},paint:{"circle-radius":["interpolate",["linear"],["zoom"],7,8,18,14],"circle-stroke-color":"#fff","circle-stroke-width":2,"circle-color":["match",["get","total"],"","#fff",["interpolate",["linear"],["get","total"],0,"#fafa6e",10,"#2A4858"]],"circle-opacity":["match",["get","total"],"",0,1],"circle-stroke-opacity":["match",["get","total"],"",0,1]}}],Y=[["".concat("HOVER","-pixel"),"pixel"],["".concat("HOVER","-gauge"),"gauge"],["".concat("HOVER","-gauge-halo"),"gauge"]],F=["pixel-results","gauge-results"],q=["#fde725","#5dc962","#20908d","#3a528b","#440154"],G=[.1,.2,.4,.6,.8,1,1.5,2,2.5,3,3.5,4,4.5,5],z={progress:{tab:L,mapLoaded:!1,initialStyleLoaded:!1,isFetching:!0,isThinking:0,messages:[]},fetchKwargs:(n={},Object(d.a)(n,L,{active:{startDt:null,endDt:null,sensorLocations:{gauge:[],basin:[],pixel:[]},rollup:"Total",zerofill:!0,f:"sensor"},history:[]}),Object(d.a)(n,P,{active:{startDt:null,endDt:null,sensorLocations:{gauge:[],basin:[],pixel:[]},rollup:"Total",zerofill:!0,f:"sensor"},history:[]}),Object(d.a)(n,_,{active:{startDt:null,endDt:null,sensorLocations:{gauge:[],basin:[],pixel:[]},rollup:"Total",zerofill:!0,f:"sensor"},history:[]}),n),rainfallEvents:{list:[],stats:{latest:null,longest:null,maxDate:null,minDate:A},filters:{maxHours:24}},refData:{},initMap:{token:"pk.eyJ1IjoiY2l2aWNtYXBwZXIiLCJhIjoiY2s2azUycjc4MDBvMzNsbnliZDU4dTZiZCJ9.35H-OLQdcpQuCjKE9iAmwg",latitude:40.4481524,longitude:-79.9864242,zoom:10,mapboxSources:{"3rww-rainfall-base":{type:"vector",url:"mapbox://styles/civicmapper/ck2xlf5qg2pbc1clav3r8ddku"}},sourcesToAdd:[],layersToAdd:[],attribution:'<a href="https://www.3riverswetweather.org" target="_blank">3RWW</a>, <a href="https://www.civicmapper.com" target="_blank">CivicMapper</a>.'},mapStyle:{},mapLegend:{}},K=Object(u.b)("MAP_LOADED"),B=Object(u.b)("SET_STYLE"),W=Object(u.b)("LOAD_REF_LAYERS"),V=Object(u.b)("SWITCH_TAB"),J=Object(u.b)("ASYNC_START"),Q=Object(u.b)("ASYNC_SUCCESS"),U=Object(u.b)("ASYNC_FAIL"),X=Object(u.b)("FETCHING"),Z=Object(u.b)("THINKING_1"),$=Object(u.b)("THINKING_0"),ee=Object(u.b)("CALC_EVENT_STATS"),te=Object(u.b)("PICK_EVENT"),ae=Object(u.b)("PICK_DATETIME_RANGE"),ne=Object(u.b)("PICK_SENSOR"),re=Object(u.b)("PICK_INTERVAL"),oe=Object(u.b)("PICK_ACTIVE_RESULT"),le=Object(u.b)("GETTING_RAINFALL"),ie=(Object(u.b)("GETTING_RAINFALL_INVALID"),Object(u.b)("GETTING_RAINFALL_SUCCESS")),se=Object(u.b)("GETTING_RAINFALL_FAIL"),ce=Object(u.b)("FILTER_EVENT_BY_HOUR"),ue=Object(u.b)("APPLY_COLOR_STRETCH"),de=Object(u.b)("SET_LAYER_STYLE"),pe=Object(u.b)("BUILD_LAYER_STYLE"),he=(Object(u.b)("BUILD_LEGEND"),Object(u.b)("RESET_LAYER_SRCS")),me=(Object(u.b)("START_ANIMATION"),Object(u.b)("STOP_ANIMATION"),Object(u.b)("RESTART_ANIMATION"),Object(u.b)("SET_STATE")),fe=(a(778),a(751)),be=function(e){return e.progress.tab},ge=function(e,t){return e.fetchKwargs[t].active},ye=function(e,t){return e.fetchKwargs[t].history},ve=function(e){return function(e){return e.fetchKwargs[be(e)].history}(e).find((function(e){return!0===e.isActive}))},Ee=function(e,t,a){return ye(e,a).find((function(e){return e.requestId==t}))},Oe=function(e,t,a){return e.fetchKwargs[t].active.sensorLocations[a]},je=function(e,t){return function(e){return e.mapStyle.sources}(e)[t]},we=function(e){return e.mapStyle.layers},Te=function(e,t){return we(e).filter((function(e){return Object(E.a)(t,e.id)}))},De=function(e,t){return Object(j.a)(e.mapStyle,["sources",t,"data","features"])?e.mapStyle.sources[t].data.features:[]},xe=function(e){if(Object(j.a)(e,["refData","basinPixelLookup"])){var t=e.refData.basinPixelLookup;return Object(y.a)(t).filter((function(e){return"other"!==e})).map((function(e){return{value:e,pixels:t[e]}}))}return[]},ke=function(e){return e.rainfallEvents},Se=a(93),Ce=a(766),Ae=(a(774),function(e,t){var a=e.map((function(e){return e[t]})).filter((function(e){return e>=0}));return{maxValue:Math.max.apply(Math,Object(m.a)(a)),minValue:Math.min.apply(Math,Object(m.a)(a)),maxRank:a.length}}),Ie=function(e,t,a,n,r,o,l,i){var s=Se.scale(n);r&&(s=s.mode(r)),void 0===o&&(o=5),void 0===a&&(a="id");var c,u,d=["match",["get",a]],p=["match",["get",a]],h=[],m=[];void 0===i?(i=Ae(e,t),console.log("minMax on the fly",i)):console.log("minMax provided",i),c=i.maxValue,u=i.minValue,void 0===l?(l="linear",h=Se.limits(e.map((function(e){return e[t]})),"e",o).slice(1),m=s.colors(o),e.forEach((function(e){var n=(e[t]-u)/(c-u),r=s.classes(o)(n).hex("rgb");d.push(e[a],r)}))):(m=(h=Se.limits(e.map((function(e){return e[t]})),l,o).slice(1)).map((function(e){var t=h.indexOf(h.filter((function(t){return e<=t}))[0])/h.length;return Se.scale(n).classes(o)(t).brighten(.25).saturate(.25).hex("rgb")})),e.forEach((function(e){var n=h.indexOf(h.filter((function(a){return e[t]<=a}))[0])/h.length,r=s.classes(o)(n).brighten(.25).saturate(.25).hex("rgb");d.push(e[a],r)})));e.forEach((function(e){var n=500*e[t];p.push(e[a],n)}));var f={method:l,content:Object(Ce.a)(h,m)};return d.push("rgba(255,255,255,0)"),p.push(0),{styleExp:d,legendContent:f,heightExp:p}},Re=function(e){return{type:"geojson",data:{type:"FeatureCollection",features:e.features.map((function(e){return{properties:Object(h.a)({id:e.id.toString(),label:"Virtual Gauge ".concat(e.id.toString()),data:[],total:""},e.properties),id:e.id,geometry:e.geometry}}))}}},Ne=function(e){return{type:"geojson",data:{type:"FeatureCollection",features:e.features.map((function(e){var t=e.properties,a=t.id,n=Object(p.a)(t,["id"]);return{properties:Object(h.a)({id:e.id.toString(),label:"Gauge ".concat(e.id.toString(),": ").concat(n.name),data:[],total:"",dwid:a},n),id:e.id,geometry:e.geometry}}))}}},Le=function(e){return e.events.slice(0).reverse().map((function(e,t){return Object(h.a)(Object(h.a)({},e),{},{startDt:e.start_dt,endDt:e.end_dt,hours:b()(e.end_dt).diff(b()(e.start_dt),"hours"),isFetching:!1,selected:!1})})).map((function(e){e.start_dt,e.end_dt;return Object(p.a)(e,["start_dt","end_dt"])})).filter((function(e){return e.hours>0}))},Pe=Object(u.c)(z,(r={},Object(d.a)(r,V,(function(e,t){e.progress.tab=t.payload})),Object(d.a)(r,J,(function(e,t){e.progress.isFetching=!0})),Object(d.a)(r,Q,(function(e,t){e.progress.isFetching=!1;var a=t.payload,n=a.data,r=a.pathArray,o=a.keepACopy;if(Object(g.a)(e,r,n),!0===o){var l=["refData",r[r.length-1]];Object(g.a)(e,l,n)}})),Object(d.a)(r,U,(function(e,t){e.progress.isFetching=!1,console.log(t.payload)})),Object(d.a)(r,X,(function(e,t){e.progress.isFetching=t.payload.isFetching})),Object(d.a)(r,Z,(function(e,t){void 0!==t.payload&&(console.log(t.payload),e.progress.messages.push(t.payload)),e.progress.isThinking=e.progress.isThinking+1})),Object(d.a)(r,$,(function(e,t){void 0!==t.payload&&(console.log(t.payload),e.progress.messages.push(t.payload)),e.progress.isThinking=e.progress.isThinking-1})),Object(d.a)(r,ee,(function(e,t){var a=e.rainfallEvents.list,n=a.map((function(e){return e.endDt})).sort()[a.length-1];e.rainfallEvents.stats.latest=n,e.rainfallEvents.stats.longest=Math.max.apply(Math,Object(m.a)(a.map((function(e){return e.hours})))),e.rainfallEvents.stats.maxDate=b()(n).endOf("month").format()})),Object(d.a)(r,ae,(function(e,t){var a=t.payload,n=a.contextType,r=a.startDt,o=a.endDt,l=ge(e,n);l.startDt=r,l.endDt=o,ke(e).list.filter((function(e){return e.selected})).forEach((function(e){return!1===e.selected}))})),Object(d.a)(r,te,(function(e,t){var a=t.payload,n=a.eventid,r=a.contextType,o=function(e,t){return ke(e).list.find((function(e){return e.eventid===t}))}(e,n);o.selected=!0,function(e,t){return ke(e).list.filter((function(e){return e.eventid!==t}))}(e,n).forEach((function(e,t){return e.selected=!1}));var l=ge(e,r);l.startDt=o.startDt,l.endDt=o.endDt})),Object(d.a)(r,ne,(function(e,t){var a=t.payload,n=a.contextType,r=a.sensorLocationType,o=a.selectedOptions;ge(e,n).sensorLocations[r]=null!==o?o.filter((function(e){return null!==e})):[],"basin"==r&&(null!==o?ge(e,n).sensorLocations[r].forEach((function(t,a){var r=e.refData.basinPixelLookup[t.value];console.log(t.value,r.length),ge(e,n).sensorLocations.pixel=r.map((function(e){return{value:e,label:e}}))})):ge(e,n).sensorLocations.pixel=[])})),Object(d.a)(r,re,(function(e,t){var a=t.payload,n=a.rollup,r=a.contextType;ge(e,r).rollup=n})),Object(d.a)(r,le,(function(e,t){var a=t.payload,n=a.fetchKwargs,r=a.requestId,o=a.contextType,l=a.status,i=(a.messages,Ee(e,r,o));void 0==i?ye(e,o).push({fetchKwargs:n,requestId:r,isFetching:1,isActive:!1,results:!1,status:l}):i.isFetching=i.isFetching+1})),Object(d.a)(r,ie,(function(e,t){var a=t.payload,n=a.requestId,r=a.contextType,o=a.results,l=a.processedKwargs,i=a.status;a.messages;console.log("request",n,i),function(e,t,a){return ye(e,a).filter((function(e){return e.requestId==t}))}(e,n,r).forEach((function(e){e.isFetching=e.isFetching-1,e.results=Object(h.a)(Object(h.a)({},o),e.results),e.processedKwargs=l,e.status=i}))})),Object(d.a)(r,se,(function(e,t){var a=t.payload,n=a.requestId,r=(a.results,a.status);a.messages;console.log(n,r);var o=function(e,t){var a;return Object(O.a)(e.fetchKwargs,(function(e,n){var r=e.history.find((function(e){return e.requestId==t}));void 0!==r&&(a=r)})),a}(e,n);o.isFetching=o.isFetching-1,o.status=r})),Object(d.a)(r,oe,(function(e,t){var a=t.payload,n=a.requestId,r=a.contextType;(function(e,t,a){return ye(e,a).filter((function(e){return e.requestId!==t}))})(e,n,r).forEach((function(e){return e.isActive=!1}));var o=Ee(e,n,r);o.isActive=!0,Object(y.a)(o.results).forEach((function(t){console.log("getting reference ".concat(t," layer"));var a=Object(v.a)(e.refData[t].data),n=o.results[t];console.log("joining ".concat(t," results to layer"));var r=function(e,t,a,n,r){void 0===r&&(r=!1),void 0===a&&(a="id"),void 0===n&&(n=!1);var o=e.features.map((function(e){var o=t.find((function(t){return Object(w.a)(t,n)===Object(w.a)(e,a)}));return void 0===o?!r&&e:{id:e.id,geometry:e.geometry,properties:Object(h.a)(Object(h.a)({},e.properties),o)}}));return r&&(o=o.filter((function(e){return!1!==e}))),{type:"FeatureCollection",features:o}}(a,n,"properties.id","id",!1);console.log("pushing udpated ".concat(t," results layer to map")),je(e,t).data=r})),Object(y.a)(N).filter((function(e){return!Object(E.a)(Object(y.a)(o.results),e)})).forEach((function(t){console.log(t);var a=Object(v.a)(e.refData[t].data);je(e,t).data=a}))})),Object(d.a)(r,he,(function(e,t){var a=t.payload.lyrSrcNames;void 0===a&&(a=Object(y.a)(N)),a.length>0&&a.forEach((function(t){var a=Object(v.a)(e.refData[t].data);je(e,t).data=a}))})),Object(d.a)(r,ce,(function(e,t){e.eventFilters.maxHours=t.payload.maxHours})),Object(d.a)(r,K,(function(e,t){return e.progress.mapLoaded||(e.progress.mapLoaded=!0),e})),Object(d.a)(r,B,(function(e,t){return e.mapStyle=t.payload,e.progress.initialStyleLoaded||(e.progress.initialStyleLoaded=!0),e})),Object(d.a)(r,W,(function(e,t){Object(O.a)(t.payload,(function(t,a){if(Object(j.a)(t,"INDEX")){var n=t.INDEX,r=Object(p.a)(t,["INDEX"]),o=Object(m.a)(e.mapStyle.layers);o.splice(n,0,r),e.mapStyle.layers=o}else e.mapStyle.layers.push(t)}))})),Object(d.a)(r,me,(function(e,t){var a=t.payload,n=a.data,r=a.path,o=a.how;if("replace"==o)Object(g.a)(e,r,n);else if("append"==o){var l=Object(w.a)(e,r);Object(g.a)(e,r,[].concat(Object(m.a)(l),Object(m.a)(n)))}})),Object(d.a)(r,pe,(function(e,t){var a=t.payload,n=a.requestId,r=a.contextType,o=a.sensor,l=Ee(e,n,r),i=Object(y.a)(l.results),s=[];i.forEach((function(e){s=s.concat(l.results[e])}));var c=Ae(s,"total");console.log(c);var u=Ie(s,"total","id",q,"lch",7,"e",c);Object(g.a)(l,["styleExp",o],u.styleExp),Object(g.a)(l,["heightExp",o],u.heightExp),l.stats=c})),Object(d.a)(r,de,(function(e,t){var a=t.payload,n=a.requestId,r=a.contextType,o=(a.sensor,Ee(e,n,r)),l=Object(y.a)(o.results),i=Object(y.a)(N).filter((function(e){return!Object(E.a)(l,e)}));l.forEach((function(t){if(Object(j.a)(o,["styleExp",t])&&Object(j.a)(o,["heightExp",t])){var a=o.styleExp[t],n=o.heightExp[t],r=["".concat(t,"-results"),"".concat(t,"-results-3d")];Te(e,r).forEach((function(e){e.paint["".concat(e.type,"-color")]=a,"fill-extrusion"==e.type?(e.paint["".concat(e.type,"-base")]=0,e.paint["".concat(e.type,"-height")]=n,e.paint["".concat(e.type,"-opacity")]=1):e.paint["".concat(e.type,"-opacity")]=.5}))}else console.log("style and legend not previously calculated.")})),i.forEach((function(t){var a=["".concat(t,"-results")];Te(e,a).forEach((function(e){e.paint["".concat(e.type,"-color")]="#fff",e.paint["".concat(e.type,"-opacity")]=0}))}))})),Object(d.a)(r,ue,(function(e,t){var a=function(e,t,a,n,r,o){var l;void 0===t&&(t=G),void 0===e&&(e="total"),void 0===n&&(n=q),void 0===r&&(r="lch"),l=void 0===a?Se.scale(n).mode(r).domain([0,Math.max.apply(Math,Object(m.a)(t))]):a.domain([0,Math.max.apply(Math,Object(m.a)(t))]).classes(t),void 0===o&&(o="linear");var i=["interpolate",[o],["get",e]];return t.forEach((function(e){i.push(e),i.push(l(e).hex("rgb"))})),i}("total",t.payload.breaks);F.forEach((function(t){var n=function(e,t){return we(e).find((function(e){return e.id===t}))}(e,t);n.paint["".concat(n.type,"-color")]=a}))})),r)),_e=Object(u.a)({reducer:Pe,devTools:!0}),Me=(a(549),a(550),a(16)),He=a(17),Ye=a(19),Fe=a(18),qe=a(761),Ge=a(23),ze=a(752),Ke=a(327),Be=a(769),We=a(771),Ve=a(763),Je=a(753),Qe=a(325),Ue=a.n(Qe),Xe=a(244),Ze=a.n(Xe),$e=a(326);function et(e){return function(t){var a,n=e.url,r=e.pathArray,o=e.transformer,l=e.keepACopy;return t(Z('getting data from "'.concat(n,'"'))),t(J(n)),Ze()({url:n,method:"GET"}).then((function(e){return a=o?o(e.data):e.data,t(Q({data:a,pathArray:r,keepACopy:l})),!0}),(function(e){return console.log("An error occurred.",e),t(U("An error occurred.")),!1})).finally((function(){return t($('data from "'.concat(n,'" loaded to ').concat(r.join("."))))}))}}function tt(e){return function(e){e(Z("Loading reference data and map layers")),function(e){return Promise.all([new Promise((function(t,a){t(e(et({url:D,pathArray:["rainfallEvents","list"],transformer:Le,keepACopy:!1})))})),new Promise((function(t,a){t(e(et({url:S,pathArray:["refData","basinPixelLookup"],transformer:!1,keepACopy:!1})))})),new Promise((function(t,a){t(e(et({url:k,pathArray:["mapStyle","sources","gauge"],transformer:Ne,keepACopy:!0})))})),new Promise((function(t,a){t(e(et({url:x,pathArray:["mapStyle","sources","pixel"],transformer:Re,keepACopy:!0})))}))])}(e).then((function(t){e(W(H)),e(ue({breaks:G})),e(ee())})).then((function(){var t=_e.getState().rainfallEvents.stats.maxDate;e(ae({contextType:L,startDt:b()().subtract(2,"hour").toISOString(),endDt:b()().toISOString()})),e(ae({contextType:P,startDt:b()(t).startOf("month").toISOString(),endDt:t})),e(ae({contextType:_,startDt:b()(t).startOf("month").toISOString(),endDt:t}))})).then((function(){return e($("Initial data load complete."))}))}}function at(e){var t=_e.getState();return function(a){var n=e.contextType,r=e.rainfallDataType,o=ge(t,n),l=Object($e.MD5)(o),i=Ee(t,l,n);void 0!==i&&(console.log("This exact request was already made. Keeping existing data from request",i.requestId),!1===i.isActive&&a(oe({requestId:i.requestId,contextType:n})));["gauge","basin"].forEach((function(e,t){if(0!==o.sensorLocations[e].length){var i={start_dt:o.startDt,end_dt:o.endDt,rollup:o.rollup,f:o.f},s="basin"===e?["pixel","pixels"]:["gauge","gauges"];i[s[1]]=o.sensorLocations[s[0]].map((function(e){return e.value})).join(","),a(le({fetchKwargs:o,requestId:l,contextType:n}));var c="".concat("https://trwwapi.herokuapp.com/rainfall/","v2/").concat(s[0],"/").concat(r,"/");!function e(t,a,n,r,o,l){var i={url:o,method:"POST"};!1!==l&&(i.data=l),Ze()(i).then((function(o){var l=o.data;console.log("job ".concat(l.meta.jobId," ").concat(l.status," - ").concat(n)),Object(E.a)(["queued","started"],l.status)?setTimeout((function(){return e(t,a,n,r,l.meta.jobUrl,!1)}),1e3):Object(E.a)(["deferred","failed"],l.status)?t(se({requestId:a,contextType:r,results:Object(d.a)({},n,!1),status:l.status,messages:l.messages})):"finished"===l.status?(l=function(e){return e.data.forEach((function(e){var t=e.data.length>1&0!==e.data.length?e.data.filter((function(e){return e.val>=0})).map((function(e){return e.val})).reduce((function(e,t){return e+t}),0):e.data[0].val;e.total=t})),e}(l),t(ie({requestId:a,contextType:r,results:Object(d.a)({},n,l.data),processedKwargs:l.args,status:l.status})),t(oe({requestId:a,contextType:r}))):"does not exist"===l.status&&(console.log("Job was cancelled."),t(se({requestId:a,contextType:r,results:Object(d.a)({},n,!1),status:l.status,messages:l.messages})))}),(function(e){console.log("An error occurred.",e),t(se({requestId:a,contextType:r,results:Object(d.a)({},n,!1),status:"error",messages:[]}))}))}(a,l,s[0],n,c,i)}}))}}function nt(e){var t=e.contextType,a=Object(p.a)(e,["contextType"]);return function(e){var n=a.requestId;a.isActive||e(oe({requestId:n,contextType:t}))}}function rt(e){var t=e;return function(e){e(V(t));var a=ve(_e.getState());console.log(a),e(void 0===a?he({lyrSrcNames:Object(y.a)(N)}):oe({requestId:a.requestId,contextType:t}))}}a(702);var ot=function(e){Object(Ye.a)(a,e);var t=Object(Fe.a)(a);function a(e,n){var r;return Object(Me.a)(this,a),(r=t.call(this,e,n)).handleShow=r.handleShow.bind(Object(Ge.a)(r)),r.handleClose=r.handleClose.bind(Object(Ge.a)(r)),r.state={show:!0,showWhich:"AboutButton",content:{AboutButton:{title:l.a.createElement(ze.a,null,l.a.createElement(Ke.a,{sm:9},l.a.createElement("h1",null,"Make It Rain ",l.a.createElement("small",null,l.a.createElement("em",null,"beta"))),l.a.createElement("h2",null,l.a.createElement("small",null,"Hyper-local rainfall data for Allegheny County"))),l.a.createElement(Ke.a,null,l.a.createElement("small",null,"A project by "),l.a.createElement("br",null),l.a.createElement("img",{className:"brand-logo",src:"".concat(T,"static/assets/3rww_logo_full_inverse_transparent_blue.png"),placeholder:"3 River Wet Weather",alt:"3RWW Logo"}))),content:"\nHave you ever wondered how rainfall is actually measured? Technical instruments, called rain gauges, are designed to collect and accurately measure rainfall during wet weather events. However, a rain gauge can only provide a specific rainfall measurement for the limited geographic area where the gauge is located.\n\nOn the flip side, radar systems, often used in weather reports, do not measure rainfall directly, but rather they detect the intensity of microwave energy reflected by raindrops, called reflectivity. Through the use of a mathematical formula, the reflectivity of the raindrops can be converted by the radar system into rainfall estimates for a particular defined area.\n\nNeither measurement technique is perfect, but when the two are combined\u2014when radar estimates are calibrated with actual rain gauge data\u2014a highly accurate and valuable source of rainfall data can be calculated over large geographic areas.\n\nBecause engineers and planners addressing the wet weather issue need this level of accuracy, 3 Rivers Wet Weather created the calibrated radar rainfall system in 2001. Communities throughout Allegheny County use this data\u2014provided in both real-time and historical formats\u2014to design more cost-effective solutions to reduce or eliminate sewage overflows and improve stormwater management.\n\nThe NEXRAD radar (located in Moon Township) data is calibrated with the rain gauge measurements collected during the same time period and rain event for every square kilometer in Allegheny County. The resulting rainfall data is equivalent in accuracy to having 2,276 rain gauges placed across the County.\n\n---\n\n## Available Datasets\n\nCurrently, this site offers rainfall data in three buckets:\n\n* Real-time Rainfall data: provisional rainfall data for both gauges and radar pixels\n* Historical Rain Gauge data: QA/QC'd rain gauge data, usually available within 30-60 days.\n* Calibrated Radar Rainfall data: QA/QC'd, gauge-adjusted radar rainfall observations, typically available within 30-60 days.\n\n### Real-time Rainfall Data\n\nData from 33 rain gauges is collected and updated every 15 minutes to calibrate live weather radar to provide accurate, quality rainfall information as it is occurring.\n\nRain gauge data also is available in this section for the most recent 30-to-60-day period, spanning from the first day of the previous month to the current date in the present month. (Example: If the date is November 15, data can be obtained for as little as one day up to 45 days\u2014October 1-November 15. If it is the last day of the present month\u2014November 30\u2014a full 60 days of data is available).\n\nFully calibrated rainfall data (older than 30 days with completed QA/QC) for any given month is available through the \"Calibrated Radar Rainfall Data\" section, generally within 15 days of the end of each month.\n\nSeveral options for data output are provided on the real-time site via simple links.\n\n* A bar graph and data table (in 15-min. increments) showing rainfall over the last 4 hours for a specified pixel on the map (2,276 pixels are available).\n* An animated map showing the rainfall over the last 2-hour, 4-hour or 6-hour time period.\n* A table recording the raw rainfall data for individual rain gauges over the last 30-60 days.\n* A cumulative color-coded map showing the amount of rainfall occurring over a specified period. Data can be accessed from the first day of the previous month to the current date. Be sure to specify the time period, and select the appropriate rainfall scale (.5 inch, 5 inches or 10 inches.) For particularly long periods of time or heavy rainfall periods, a higher scale will provide a better range of colors in the final map.\n* Rainfall amount collected over the most recent 4-hour period by an individual rain gauge. A bar graph and data table show the actual rainfall collected by the specific gauge in 15-min. increments. \n\n### Historical Rain Gauge\n\nThe data from 33 rain gauges is archived in this section. The data may be retrieved for any combination of the rain gauges during a specified time span. The data may also be displayed in 15-minute increments or compressed to hourly or daily data points. The data may be viewed on the page or downloaded into a comma-separated output format which may be saved and loaded into a spreadsheet or database that accepts comma-separated files.\n\n\n### Calibrated Radar Rainfall\n\nThe calibrated radar rainfall section allows the retrieval of data for each of the 2313 pixels mapped by the radar cross-section.\n\n---\n\n## Querying Rainfall\n\nSelect the start and end date/time, along with the interval. Rainfall data is collected and stored in 15-minute increments, which allows for 15-minute, hourly, and daily intervals as options for the selectable increment. Note that if a daily increment is selected, the start and end selections will begin at midnight and the start and end hour will be ignored.\n\nQuerying results will listed in a panel below. The data output may be viewed and downloaded on the page by selecting the 'View and Download Results' Button \n\nThe output for each timestamp contains a gauge or pixel ID, a rainfall amount, and a source code. The amount is the rainfall in inches. The source can be found in the following table:\n\n| Source |\tDescription |\n| --- | --- |\n| R |\tCalibrated radar rainfall data |\n| G-0 | No gauge or calibrated radar rainfall data is available, but not for the reasons given for N/D below |\n| G-1 |\tDerived from inverse distance squared weighting based on one rain gauge |\n| G-2 |\tDerived from inverse distance squared weighting based on two rain gauges |\n| G-3 |\tDerived from inverse distance squared weighting based on three rain gauges |\n| N/D |\tNo data was collected for this data point. This may be because no data was collected at the time or the pixel may be outside of the data collection boundary. |\n| RTRR | Real-time radar rainfall. Data shown are provisional.|\n| RTRG | Real-time rain gauge data. Data shown are provisional. |\n\n\nNote that the source code only appears for the 15-minute increments because an hourly or daily increment may include many different sources.\n          "}}},r}return Object(He.a)(a,[{key:"handleClose",value:function(e){this.setState({show:!1,showWhich:null})}},{key:"handleShow",value:function(e){console.log(e.target.id),this.setState({show:!0,showWhich:e.target.id})}},{key:"render",value:function(){return l.a.createElement("div",{className:"nav-container"},l.a.createElement(Be.a,{bg:"primary",variant:"dark",expand:"md"},l.a.createElement(Be.a.Brand,{className:"d-none d-sm-block"},l.a.createElement("img",{className:"nav-brand-logo",src:"/static/assets/3rww_logo_full_inverse_transparent.png",alt:"3RWW Logo"}),"\xa0 Rainfall"),l.a.createElement(Be.a.Brand,{className:"d-block d-sm-none",style:{fontSize:"0.9rem"}},l.a.createElement("img",{className:"nav-brand-logo-xs",src:"/static/assets/3rww_logo_full_inverse_transparent.png",alt:"3RWW Logo"}),"\xa0 Rainfall"),l.a.createElement(Be.a.Toggle,{"aria-controls":"basic-navbar-nav"}),l.a.createElement(Be.a.Collapse,{id:"basic-navbar-nav"},l.a.createElement(We.a,{variant:"pills",className:"mr-auto",defaultActiveKey:L},l.a.createElement(We.a.Item,null,l.a.createElement(We.a.Link,{active:this.props.tab===L,eventKey:L,onSelect:this.props.switchContext},"Real-Time Rainfall")),l.a.createElement(We.a.Item,null,l.a.createElement(We.a.Link,{active:this.props.tab===P,eventKey:P,onSelect:this.props.switchContext},"Historical Rain Gauge")),l.a.createElement(We.a.Item,null,l.a.createElement(We.a.Link,{active:this.props.tab===_,eventKey:_,onSelect:this.props.switchContext},"Calibrated Radar Rainfall"))),l.a.createElement(We.a,{className:"ml-auto"},l.a.createElement(We.a.Item,{className:"btn btn-outline-light btn-sm",id:"AboutButton",onClick:this.handleShow},"About")))),l.a.createElement(Ve.a,{show:this.state.show,onHide:this.handleClose,size:"lg"},l.a.createElement(Ve.a.Header,{closeButton:!0},l.a.createElement(Ve.a.Title,null,this.state.showWhich?this.state.content[this.state.showWhich].title:null)),l.a.createElement(Ve.a.Body,null,l.a.createElement(Ue.a,{source:this.state.showWhich?this.state.content[this.state.showWhich].content:null,escapeHtml:!1})),l.a.createElement(Ve.a.Footer,null,l.a.createElement(Je.a,{variant:"secondary",onClick:this.handleClose},"Close"))))}}]),a}(o.Component);var lt={switchContext:rt},it=Object(c.b)((function(e){return{isThinking:e.progress.isThinking>0,mapLoaded:e.progress.mapLoaded,tab:e.progress.tab}}),lt)(ot),st=a(757),ct=a(758),ut=a(759),dt=a(760),pt=a(197),ht=a(94),mt=a.n(ht),ft=a(330),bt=a.n(ft),gt=a(764),yt="setStyle",vt="addLayer",Et="removeLayer",Ot="setPaintProperty",jt="setLayoutProperty",wt="setFilter",Tt="addSource",Dt="removeSource",xt="setGeoJSONSourceData",kt="setLayerZoomRange",St="setLayerProperty",Ct="setCenter",At="setZoom",It="setBearing",Rt="setPitch",Nt="setSprite",Lt="setGlyphs",Pt="setTransition",_t="setLight";function Mt(e,t,a){a.push({command:Tt,args:[e,t[e]]})}function Ht(e,t,a){t.push({command:Dt,args:[e]}),a[e]=!0}function Yt(e,t,a,n){Ht(e,a,n),Mt(e,t,a)}function Ft(e,t,a){var n;for(n in e[a])if(e[a].hasOwnProperty(n)&&"data"!==n&&!Object(gt.a)(e[a][n],t[a][n]))return!1;for(n in t[a])if(t[a].hasOwnProperty(n)&&"data"!==n&&!Object(gt.a)(e[a][n],t[a][n]))return!1;return!0}function qt(e,t,a,n,r,o){var l;for(l in t=t||{},e=e||{})e.hasOwnProperty(l)&&(Object(gt.a)(e[l],t[l])||a.push({command:o,args:[n,l,t[l],r]}));for(l in t)t.hasOwnProperty(l)&&!e.hasOwnProperty(l)&&(Object(gt.a)(e[l],t[l])||a.push({command:o,args:[n,l,t[l],r]}))}function Gt(e){return e.id}function zt(e,t){return e[t.id]=t,e}var Kt=function(e,t){if(!e)return[{command:yt,args:[t]}];var a=[];try{if(!Object(gt.a)(e.version,t.version))return[{command:yt,args:[t]}];Object(gt.a)(e.center,t.center)||a.push({command:Ct,args:[t.center]}),Object(gt.a)(e.zoom,t.zoom)||a.push({command:At,args:[t.zoom]}),Object(gt.a)(e.bearing,t.bearing)||a.push({command:It,args:[t.bearing]}),Object(gt.a)(e.pitch,t.pitch)||a.push({command:Rt,args:[t.pitch]}),Object(gt.a)(e.sprite,t.sprite)||a.push({command:Nt,args:[t.sprite]}),Object(gt.a)(e.glyphs,t.glyphs)||a.push({command:Lt,args:[t.glyphs]}),Object(gt.a)(e.transition,t.transition)||a.push({command:Pt,args:[t.transition]}),Object(gt.a)(e.light,t.light)||a.push({command:_t,args:[t.light]});var n={},r=[];!function(e,t,a,n){var r;for(r in t=t||{},e=e||{})e.hasOwnProperty(r)&&(t.hasOwnProperty(r)||Ht(r,a,n));for(r in t)t.hasOwnProperty(r)&&(e.hasOwnProperty(r)?Object(gt.a)(e[r],t[r])||("geojson"===e[r].type&&"geojson"===t[r].type&&Ft(e,t,r)?a.push({command:xt,args:[r,t[r].data]}):Yt(r,t,a,n)):Mt(r,t,a))}(e.sources,t.sources,r,n);var o=[];e.layers&&e.layers.forEach((function(e){n[e.source]?a.push({command:Et,args:[e.id]}):o.push(e)})),a=a.concat(r),function(e,t,a){t=t||[];var n,r,o,l,i,s,c,u=(e=e||[]).map(Gt),d=t.map(Gt),p=e.reduce(zt,{}),h=t.reduce(zt,{}),m=u.slice(),f=Object.create(null);for(n=0,r=0;n<u.length;n++)o=u[n],h.hasOwnProperty(o)?r++:(a.push({command:Et,args:[o]}),m.splice(m.indexOf(o,r),1));for(n=0,r=0;n<d.length;n++)o=d[d.length-1-n],m[m.length-1-n]!==o&&(p.hasOwnProperty(o)?(a.push({command:Et,args:[o]}),m.splice(m.lastIndexOf(o,m.length-r),1)):r++,s=m[m.length-n],a.push({command:vt,args:[h[o],s]}),m.splice(m.length-n,0,o),f[o]=!0);for(n=0;n<d.length;n++)if(l=p[o=d[n]],i=h[o],!f[o]&&!Object(gt.a)(l,i))if(Object(gt.a)(l.source,i.source)&&Object(gt.a)(l["source-layer"],i["source-layer"])&&Object(gt.a)(l.type,i.type)){for(c in qt(l.layout,i.layout,a,o,null,jt),qt(l.paint,i.paint,a,o,null,Ot),Object(gt.a)(l.filter,i.filter)||a.push({command:wt,args:[o,i.filter]}),Object(gt.a)(l.minzoom,i.minzoom)&&Object(gt.a)(l.maxzoom,i.maxzoom)||a.push({command:kt,args:[o,i.minzoom,i.maxzoom]}),l)l.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?qt(l[c],i[c],a,o,c.slice(6),Ot):Object(gt.a)(l[c],i[c])||a.push({command:St,args:[o,c,i[c]]}));for(c in i)i.hasOwnProperty(c)&&!l.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?qt(l[c],i[c],a,o,c.slice(6),Ot):Object(gt.a)(l[c],i[c])||a.push({command:St,args:[o,c,i[c]]}))}else a.push({command:Et,args:[o]}),s=m[m.lastIndexOf(o)+1],a.push({command:vt,args:[i,s]})}(o,t.layers,a)}catch(l){console.warn("Unable to compute style diff:",l),a=[{command:yt,args:[t]}]}return a},Bt=a(775),Wt=a(776),Vt=a(781),Jt=(a(731),function(e){var t=e.features;return t.filter((function(e){return void 0!==e.id})).length>0?l.a.createElement(Wt.a,null,l.a.createElement(Bt.a,{variant:"flush"},t.filter((function(e){return void 0!==e.id})).map((function(e,t){var a,n,r=e.properties;return l.a.createElement(Bt.a.Item,{key:t},l.a.createElement("h6",{className:"tooltip-header"},r.label),""!==r.total?l.a.createElement("p",{className:"tooltip-body"},"Total rainfall: ",l.a.createElement("strong",null,(a=r.total,n=2,Object(Vt.a)(a,n).toFixed(n)))," inches"):null)})))):null}),Qt=(a(732),a(733),a(734),function(e){Object(Ye.a)(a,e);var t=Object(Fe.a)(a);function a(e){var n;return Object(Me.a)(this,a),(n=t.call(this,e)).state={features:[]},n}return Object(He.a)(a,[{key:"componentDidMount",value:function(){this.props.loadingMap(),this.loadMap()}},{key:"componentWillReceiveProps",value:function(e){this.updateMapStyle(e.mapStyle)}},{key:"setTooltip",value:function(e){e.length?s.a.render(l.a.createElement(Jt,{features:e}),this.tooltipContainer):s.a.unmountComponentAtNode(this.tooltipContainer)}},{key:"makeTooltipOnHover",value:function(e,t){if(void 0!==e){var a=this.webmap.queryRenderedFeatures(e.point,{layers:["HOVER-pixel","HOVER-gauge"]});t.setLngLat(e.lngLat),this.webmap.getCanvas().style.cursor=a.length?"pointer":"",this.setTooltip(a),this.setState({features:a})}}},{key:"loadMap",value:function(){var e=this,t={container:"map",style:this.props.initMap.mapboxSources["3rww-rainfall-base"].url,center:[this.props.initMap.longitude,this.props.initMap.latitude],zoom:this.props.zoom,attributionControl:!1};mt.a.accessToken=this.props.token,this.webmap=new mt.a.Map(t),this.tooltipContainer=document.createElement("div");var a=new mt.a.Marker(this.tooltipContainer,{offset:[105,0]}).setLngLat([0,0]).addTo(this.webmap);this.webmap.on("load",(function(){e.webmap.addControl(new bt.a({accessToken:mt.a.accessToken,mapboxgl:mt.a,placeholder:"Fly me to...",marker:!1,collapsed:!0,clearAndBlurOnEsc:!0,clearOnBlur:!0,countries:"us"})),e.webmap.addControl(new mt.a.NavigationControl),e.webmap.addControl(new mt.a.AttributionControl({compact:!0,customAttribution:e.props.initMap.attribution})),e.props.initMap.sourcesToAdd.forEach((function(t){e.webmap.addSource(t.sourceName,t.sourceData)})),e.props.initMap.layersToAdd.forEach((function(t){t.layerStyles.forEach((function(a){e.webmap.addLayer(a,t.addLayerStylesAbove)}))}));var t=e.webmap.getStyle();e.props.setStyle(t),e.props.mapLoaded(e.webmap.loaded()),e.props.initFetchData()}));var n={};Y.forEach((function(t){var r=t[0],o=t[1];n[r]=null,e.webmap.on("mousemove",r,(function(t){e.makeTooltipOnHover(t,a),e.webmap.getCanvas().style.cursor=t.features.length?"pointer":"",t.features.length>0&&(n[r]&&e.webmap.setFeatureState({source:o,id:n[r]},{hover:!1}),n[r]=t.features[0].id,e.webmap.setFeatureState({source:o,id:n[r]},{hover:!0}))})),e.webmap.on("mouseleave",r,(function(t){e.makeTooltipOnHover(t,a),e.webmap.getCanvas().style.cursor="",n[r]&&e.webmap.setFeatureState({source:o,id:n[r]},{hover:!1}),n[r]=null}))}))}},{key:"updateMapStyle",value:function(e){if(null!==this.props.mapStyle&&!Object(fe.a)(this.props.mapStyle)){var t=this.webmap,a=pt.a.fromJS(this.props.mapStyle),n=pt.a.fromJS(e);if(!pt.a.is(a,n)){var r=Kt(a.toJS(),n.toJS());console.log("updating mapStyle (".concat(r.map((function(e){return e.command})),")")),r.forEach((function(e){if("setGeoJSONSourceData"==e.command){var a=t.getSource(e.args[0]);a&&a.setData(e.args[1])}else t[e.command].apply(t,e.args)}))}}}},{key:"render",value:function(){return l.a.createElement("div",{className:"map",id:"map"})}}]),a}(o.Component));var Ut=Object(c.b)((function(e){return{mapStyle:e.mapStyle,initMap:e.initMap}}),(function(e,t){return{loadingMap:function(t){e(Z("Loading the map"))},setStyle:function(t){e(B(t))},mapLoaded:function(t){e(K(t)),e($("Map loaded"))},initFetchData:function(t){return e(tt())}}}))(Qt),Xt=a(754),Zt=a(332),$t=a(755),ea=a(331),ta=a.n(ea),aa=a(138),na=a(139),ra=a(777),oa=(a(738),function(e){Object(Ye.a)(a,e);var t=Object(Fe.a)(a);function a(e){var n;return Object(Me.a)(this,a),(n=t.call(this,e)).handleListClick=n.handleListClick.bind(Object(Ge.a)(n)),n}return Object(He.a)(a,[{key:"handleListClick",value:function(e){this.props.dispatchPickRainfallEvent(e)}},{key:"render",value:function(){var e=this;return l.a.createElement(ze.a,null,l.a.createElement(Ke.a,null,l.a.createElement(Bt.a,{variant:"flush"},this.props.events.map((function(t,a){var n=b()(t.startDt),r=b()(t.endDt),o=t.hours/48*100;return l.a.createElement(Bt.a.Item,{action:!0,onClick:function(){return e.handleListClick(t.eventid)},key:a,eventKey:t.eventid,className:"event-list-item"},l.a.createElement("small",null,l.a.createElement(ze.a,null,l.a.createElement(Ke.a,{xs:7},n.format("DD MMM YYYY, h:mm a")," \u2014 ",r.format("DD MMM YYYY, h:mm a"),"\xa0"),l.a.createElement(Ke.a,{xs:5},t.hours," hour",t.hours>1?"s":""))),l.a.createElement(ze.a,null,l.a.createElement(Ke.a,null,l.a.createElement(ra.a,{className:"event-length-bar",now:o,variant:"primary"}))))})))))}}]),a}(l.a.Component));var la=Object(c.b)((function(e){var t=ke(e);return{events:t.list.filter((function(e){return t.filters.maxHours>=24||e.hours<=t.filters.maxHours?e:void 0})),maxHours:parseFloat(t.stats.longest)}}),(function(e,t){return{dispatchPickRainfallEvent:function(a){e(te({eventid:a,contextType:t.contextType}))}}}))(oa),ia=(a(739),a(740),function(e){Object(Ye.a)(a,e);var t=Object(Fe.a)(a);function a(e){var n;return Object(Me.a)(this,a),(n=t.call(this)).handleOnApply=n.handleOnApply.bind(Object(Ge.a)(n)),n.handleShow=n.handleShow.bind(Object(Ge.a)(n)),n.handleClose=n.handleClose.bind(Object(Ge.a)(n)),n.state={show:!1},n}return Object(He.a)(a,[{key:"handleOnApply",value:function(e,t){this.props.dispatchPickRainfallDateTimeRange({startDt:t.startDate.toISOString(),endDt:t.endDate.toISOString()})}},{key:"handleClose",value:function(e){this.setState({show:!1})}},{key:"handleShow",value:function(e){this.setState({show:!0})}},{key:"render",value:function(){return l.a.createElement("div",null,l.a.createElement(Ve.a,{show:this.state.show,onHide:this.handleClose,size:"lg"},l.a.createElement(Ve.a.Header,{closeButton:!0},l.a.createElement(Ve.a.Title,null,"Select A Rainfall Event")),l.a.createElement(Ve.a.Body,null,l.a.createElement(la,{contextType:this.props.contextType,handleClose:this.handleClose})),l.a.createElement(Ve.a.Footer,null,l.a.createElement(Je.a,{variant:"secondary",onClick:this.handleClose},"Close"))),l.a.createElement(ze.a,{noGutters:!0},l.a.createElement(Ke.a,null,l.a.createElement("strong",null,"When"))),l.a.createElement(ze.a,{noGutters:!0},l.a.createElement(Ke.a,null,!1!==this.props.startDt&&!1!==this.props.endDt?l.a.createElement(Xt.a,{className:"datetimepicker-control"},l.a.createElement(Zt.a,{plaintext:!0,readOnly:!0,placeholder:"start and end date/times",value:"".concat(this.props.startDt.format("MM/DD/YYYY hh:mm A")," to ").concat(this.props.endDt.format("MM/DD/YYYY hh:mm A")),"aria-label":"start and end dates",className:"datetimepicker-control"}),l.a.createElement(Xt.a.Append,null,l.a.createElement(ta.a,{id:"dtp-show-daterangepicker-".concat(this.props.rainfallDataType),startDate:this.props.startDt,endDate:this.props.endDt,maxDate:this.props.maxDate,timePicker:!0,timePickerIncrement:15,showDropdowns:!1,ranges:this.props.ranges,alwaysShowCalendars:!0,onApply:this.handleOnApply},l.a.createElement(Je.a,{variant:"light",className:"datetimepicker-control"},l.a.createElement(aa.a,{icon:na.a}))),this.props.rainfallDataType===I?l.a.createElement(Je.a,{id:"dtp-show-eventlistmodal",variant:"light",onClick:this.handleShow,className:"datetimepicker-control"},l.a.createElement(aa.a,{icon:na.c})):null)):l.a.createElement($t.a,{animation:"border",variant:"primary",size:"sm"},l.a.createElement("span",{className:"sr-only"},'"Fetching historic ranges...')))))}}]),a}(l.a.Component));var sa=Object(c.b)((function(e,t){var a=ge(e,t.contextType),n=function(e){return e.rainfallEvents.stats}(e),r=b()(a.startDt),o=b()(a.endDt),l=!1,i={};if(t.rainfallDataType===I&&null!==n.maxDate)l=n.maxDate,i={"Latest month":[b()(l).startOf("month"),b()(l)],"Latest 3 months":[b()(l).subtract(2,"month").startOf("month"),b()(l)],"Latest 6 months":[b()(l).subtract(5,"month").startOf("month"),b()(l)],"Latest 12 months":[b()(l).subtract(11,"month").startOf("month"),b()(l)],"Latest Available This Year":[b()(l).startOf("year"),b()(l)],"Last Year":[b()(l).subtract(1,"year").startOf("year"),b()(l).subtract(1,"year").endOf("year")]};else if(t.rainfallDataType===R){var s=b()().toISOString();i={"Past 2 hours":[b()(s).subtract(2,"hour"),b()(s)],"Past 4 hours":[b()(s).subtract(4,"hour"),b()(s)],"Past 6 hours":[b()(s).subtract(6,"hour"),b()(s)],"Past 12 hours":[b()(s).subtract(12,"hour"),b()(s)],"Past 24 hours":[b()(s).subtract(24,"hour"),b()(s)],"Past 48 hours":[b()(s).subtract(48,"hour"),b()(s)],Today:[b()(s).startOf("day"),b()(s)],Yesterday:[b()(s).subtract(1,"day").startOf("day"),b()(s).subtract(1,"day").endOf("day")],"Past 3 days":[b()(s).subtract(3,"day").startOf("day"),b()(s)],"Past 7 days":[b()(s).subtract(7,"day").startOf("day"),b()(s)],"Past month":[b()(s).subtract(1,"month").startOf("day"),b()(s)],"Past 3 months":[b()(s).subtract(3,"month").startOf("month"),b()(s)]},l=b()()}else l=!1,r=!1,o=!1,i={};return{local:{format:"MM/DD/YYYY hh:mm A"},startDt:r,endDt:o,minDate:b()(A),maxDate:b()(l),minYear:b()(A).year(),maxYear:b()().year(),ranges:i,rainfallDataType:t.rainfallDataType}}),(function(e,t){return{dispatchPickRainfallDateTimeRange:function(a){e(ae(Object(h.a)(Object(h.a)({},a),{},{contextType:t.contextType})))}}}))(ia),ca=a(246),ua=function(e){Object(Ye.a)(a,e);var t=Object(Fe.a)(a);function a(e){var n;return Object(Me.a)(this,a),(n=t.call(this)).handleSelectGauge=function(e){n.props.dispatchPickSensorParam({sensorLocationType:"gauge",selectedOptions:e})},n.handleSelectBasin=function(e){n.props.dispatchPickSensorParam({sensorLocationType:"basin",selectedOptions:null!==e?[e]:null})},n.handleOnApply=n.handleOnApply.bind(Object(Ge.a)(n)),n.handleShow=n.handleShow.bind(Object(Ge.a)(n)),n.handleClose=n.handleClose.bind(Object(Ge.a)(n)),n.state={show:!1},n}return Object(He.a)(a,[{key:"handleOnApply",value:function(){}},{key:"handleClose",value:function(e){this.setState({show:!1})}},{key:"handleShow",value:function(e){this.setState({show:!0})}},{key:"render",value:function(){return l.a.createElement("div",null,l.a.createElement(ze.a,{noGutters:!0},l.a.createElement(Ke.a,null,l.a.createElement("strong",null,"Where"))),this.props.context!==_?l.a.createElement(ze.a,{noGutters:!0},l.a.createElement(Ke.a,{md:3},l.a.createElement("small",null,"Rain Gauges")),l.a.createElement(Ke.a,{md:9},l.a.createElement(ca.a,{isMulti:!0,value:this.props.selectedGauges,onChange:this.handleSelectGauge,options:this.props.raingaugeOpts,menuPortalTarget:document.body,isClearable:!0}))):null,this.props.context!==P?l.a.createElement(ze.a,{noGutters:!0},l.a.createElement(Ke.a,{md:3},l.a.createElement("small",null,"Pixels (by Basin)")),l.a.createElement(Ke.a,{md:9},l.a.createElement(ca.a,{value:this.props.selectedBasin,onChange:this.handleSelectBasin,options:this.props.basinOpts,menuPortalTarget:document.body,isClearable:!0}))):null)}}]),a}(l.a.Component);var da=Object(c.b)((function(e,t){return{raingaugeOpts:De(e,"gauge").map((function(e){return{value:e.id,label:"".concat(e.id,": ").concat(e.properties.name)}})),basinOpts:xe(e).map((function(e){return{value:e.value,label:e.value}})),selectedBasin:Oe(e,t.contextType,"basin"),selectedRaingauges:Oe(e,t.contextType,"raingauge"),context:be(e)}}),(function(e,t){return{dispatchPickSensorParam:function(a){e(ne(Object(h.a)(Object(h.a)({},a),{},{contextType:t.contextType})))}}}))(ua),pa=a(765),ha=function(e){Object(Ye.a)(a,e);var t=Object(Fe.a)(a);function a(){var e;Object(Me.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).handleSelectInterval=function(t){e.props.dispatchPickInterval(t.currentTarget.value)},e}return Object(He.a)(a,[{key:"render",value:function(){var e=this;return l.a.createElement(ze.a,{noGutters:!0},l.a.createElement(Ke.a,{lg:3},l.a.createElement("strong",null,"Interval")),l.a.createElement(Ke.a,{lg:9},l.a.createElement(pa.a,null,C.map((function(t,a){return l.a.createElement(pa.a.Check,{defaultChecked:"Total"==t,inline:!0,key:"interval-".concat(t,"-").concat(a,"-").concat(e.props.rainfallDataType),label:t,value:t,type:"radio",id:"interval-".concat(t,"-").concat(e.props.rainfallDataType),name:"intervalRadios",onChange:e.handleSelectInterval})})))))}}]),a}(l.a.Component);var ma=Object(c.b)((function(e){return{}}),(function(e,t){return{dispatchPickInterval:function(a){e(re({rollup:a,contextType:t.contextType}))}}}))(ha),fa=a(334),ba=a(335),ga=a(756),ya=function(e){var t=e.rows,a=e.header;return l.a.createElement(ga.a,{responsive:!0,striped:!0,bordered:!0,hover:!0,size:"sm",className:"download-table"},l.a.createElement("thead",null,l.a.createElement("tr",{className:"download-table-header"},a.map((function(e,t){return l.a.createElement("th",{key:"h".concat(t)},l.a.createElement("small",null,l.a.createElement("em",null,M[e])))})))),l.a.createElement("tbody",null,t.map((function(e,t){return l.a.createElement("tr",{key:"r".concat(t)},a.map((function(a,n){return l.a.createElement("td",{key:"d".concat(t).concat(n)},l.a.createElement("small",null,e[a]))})))}))))},va=function(e){Object(Ye.a)(a,e);var t=Object(Fe.a)(a);function a(e){var n;return Object(Me.a)(this,a),(n=t.call(this)).handleDownloadClick=n.handleDownloadClick.bind(Object(Ge.a)(n)),n}return Object(He.a)(a,[{key:"handleDownloadClick",value:function(e){e.preventDefault();var t=new Blob([this.props.csv],{type:"application/csv"});Object(ba.saveAs)(t,"rainfall.csv",{autoBom:!0})}},{key:"render",value:function(){var e=this.props.fetchHistoryItem.fetchKwargs,t=e.sensorLocations,a=t.gauge,n=t.pixel;return l.a.createElement(Ve.a,{show:this.props.show,onHide:this.props.onHide,size:"lg",dialogClassName:"min-vw-95",animation:!1},l.a.createElement(Ve.a.Header,{closeButton:!0},l.a.createElement(Ve.a.Title,null,l.a.createElement(ze.a,null,l.a.createElement(Ke.a,null,l.a.createElement("h4",null,b()(e.startDt).format("DD MMM YYYY, h:mm a")," to ",b()(e.endDt).format("DD MMM YYYY, h:mm a")),l.a.createElement("hr",null))),a.length>0?l.a.createElement(ze.a,null,l.a.createElement(Ke.a,{md:3},l.a.createElement("small",null,"Gauges:")),l.a.createElement(Ke.a,{md:9},l.a.createElement("small",null,a.map((function(e){return e.label})).join(", ")))):null,n.length>0?l.a.createElement(ze.a,null,l.a.createElement(Ke.a,{md:3},l.a.createElement("small",null,"Pixels:")),l.a.createElement(Ke.a,{md:9},l.a.createElement("small",null,n.length," pixels queried"))):null,l.a.createElement(ze.a,null,l.a.createElement(Ke.a,{md:3},l.a.createElement("small",null,"Interval:")),l.a.createElement(Ke.a,{md:9},l.a.createElement("small",null,e.rollup))))),l.a.createElement(Ve.a.Body,null,l.a.createElement(ze.a,null,l.a.createElement(Ke.a,{sm:3},l.a.createElement("p",null,"Download as: ")),l.a.createElement(Ke.a,{sm:3},l.a.createElement(Je.a,{block:!0,variant:"outline-primary",size:"sm",onClick:this.handleDownloadClick},"CSV"))),l.a.createElement(ze.a,null,l.a.createElement(Ke.a,null,l.a.createElement(ya,{rows:this.props.rows,header:this.props.header})))),l.a.createElement(Ve.a.Footer,null,l.a.createElement(Je.a,{variant:"outline-secondary",onClick:this.props.onHide},"Close")))}}]),a}(l.a.Component),Ea=Object(c.b)((function(e,t){var a=t.fetchHistoryItem.results,n=[];return Object(y.a)(a).forEach((function(e){a[e].forEach((function(t){var a=t.data.map((function(a){return Object(h.a)(Object(h.a)({},a),{},{id:t.id,type:e})}));n=n.concat(a)}))})),{header:n.length>0?Object(y.a)(n[0]):[],rows:n.length>0?n:[],csv:n.length>0?Object(fa.unparse)(n):""}}))(va),Oa=(a(741),function(e){Object(Ye.a)(a,e);var t=Object(Fe.a)(a);function a(e,n){var r;return Object(Me.a)(this,a),(r=t.call(this,e,n)).handleShow=r.handleShow.bind(Object(Ge.a)(r)),r.handleClose=r.handleClose.bind(Object(Ge.a)(r)),r.state={show:!1},r}return Object(He.a)(a,[{key:"handleClose",value:function(e){this.setState({show:!1})}},{key:"handleShow",value:function(e){this.setState({show:!0}),this.props.fetchHistoryItem.isActive||(console.log(e),console.log("Loading data from",this.props.fetchHistoryItem.requestId,"to the map"),this.props.dispatchPickDownload())}},{key:"render",value:function(){var e=this.props.fetchHistoryItem,t=e.fetchKwargs,a=t.sensorLocations,n=a.gauge,r=a.pixel,o=!1!==e.results,i=e.processedKwargs;return l.a.createElement("div",{className:"download-item-wrapper"},l.a.createElement(ze.a,null,l.a.createElement(Ke.a,{sm:12},l.a.createElement(Wt.a.Title,null,b()(t.startDt).format("DD MMM YYYY, h:mm a")," to ",b()(t.endDt).format("DD MMM YYYY, h:mm a")),l.a.createElement("hr",null))),n.length>0?l.a.createElement(ze.a,null,l.a.createElement(Ke.a,{lg:3},l.a.createElement("p",{className:"di-header"},"Gauges:")),l.a.createElement(Ke.a,{lg:9},l.a.createElement("p",null,n.map((function(e){return e.label})).join(", ")))):null,r.length>0?l.a.createElement(ze.a,null,l.a.createElement(Ke.a,{lg:3},l.a.createElement("p",{className:"di-header"},"Pixels:")),l.a.createElement(Ke.a,{lg:9},l.a.createElement("p",null,r.length," pixels queried"))):null,l.a.createElement(ze.a,null,l.a.createElement(Ke.a,{lg:3},l.a.createElement("p",{className:"di-header"},"Aggregation:")),l.a.createElement(Ke.a,{lg:9},l.a.createElement("p",null,t.rollup))),void 0===i?null:l.a.createElement(ze.a,null,l.a.createElement(Ke.a,{lg:3},l.a.createElement("p",{className:"di-header"},"Date/time range queried:")),l.a.createElement(Ke.a,{lg:9},l.a.createElement("p",null,i.start_dt,"/",i.end_dt))),o?l.a.createElement(ze.a,null,l.a.createElement(Ke.a,null,l.a.createElement(Je.a,{variant:"outline-primary",size:"sm",onClick:this.handleShow},"View and Download Results Table"))):null,l.a.createElement(Ea,{show:this.state.show,onHide:this.handleClose,fetchHistoryItem:this.props.fetchHistoryItem}))}}]),a}(l.a.Component)),ja=Object(c.b)((function(e,t){return Object(h.a)({},t)}),(function(e,t){return{dispatchPickDownload:function(a){var n=Object(h.a)(Object(h.a)({},t.fetchHistoryItem),{},{contextType:t.contextType});e(nt(n))}}}))(Oa),wa=(a(742),function(e){Object(Ye.a)(a,e);var t=Object(Fe.a)(a);function a(e,n){var r;return Object(Me.a)(this,a),(r=t.call(this,e,n)).handleListClick=r.handleListClick.bind(Object(Ge.a)(r)),r}return Object(He.a)(a,[{key:"handleListClick",value:function(e){this.props.pickDownload(e)}},{key:"render",value:function(){var e=this;return l.a.createElement(Bt.a,{variant:"flush"},this.props.fetchHistory.slice(0).reverse().map((function(t,a){var n;return n=t.isActive&&"finished"===t.status?"primary":Object(E.a)(["deferred","failed","does not exist","error"],t.status)?"danger":"",l.a.createElement(Bt.a.Item,{key:a,as:"div",className:"mx-0",action:!0,onClick:function(){return e.handleListClick(t)},variant:n},l.a.createElement(ze.a,{noGutters:!0},l.a.createElement(Ke.a,{sm:t.isFetching?11:12},l.a.createElement(ja,{fetchHistoryItem:t,contextType:e.props.contextType,rainfallDataType:e.props.rainfallDataType,rainfallSensorType:e.props.rainfallSensorType})),t.isFetching?l.a.createElement(Ke.a,{sm:1},l.a.createElement($t.a,{animation:"border",variant:"primary"},l.a.createElement("span",{className:"sr-only"},'"Fetching rainfall data...'))):null))})))}}]),a}(l.a.Component)),Ta=Object(c.b)((function(e,t){var a=ye(e,t.contextType);return{fetchHistory:a,hasDownloads:a.length>0,rainfallDataType:t.rainfallDataType}}),(function(e,t){return{pickDownload:function(a){e(nt(Object(h.a)(Object(h.a)({},a),{},{contextType:t.contextType})))}}}))(wa),Da=(a(743),function(e){Object(Ye.a)(a,e);var t=Object(Fe.a)(a);function a(e){var n;return Object(Me.a)(this,a),(n=t.call(this)).handleDownloadClick=n.handleDownloadClick.bind(Object(Ge.a)(n)),n}return Object(He.a)(a,[{key:"handleDownloadClick",value:function(){this.props.fetchRainfallData({rainfallDataType:this.props.rainfallDataType,contextType:this.props.contextType})}},{key:"render",value:function(){return l.a.createElement("div",null,l.a.createElement(Wt.a,null,l.a.createElement(Wt.a.Body,null,l.a.createElement(sa,{rainfallDataType:this.props.rainfallDataType,contextType:this.props.contextType}),l.a.createElement("hr",null),l.a.createElement(da,{rainfallDataType:this.props.rainfallDataType,contextType:this.props.contextType}),l.a.createElement("hr",null),l.a.createElement(ma,{rainfallDataType:this.props.rainfallDataType,contextType:this.props.contextType}),l.a.createElement("hr",null),l.a.createElement(Je.a,{onClick:this.handleDownloadClick,disabled:!this.props.hasKwargs,block:!0},"Get Rainfall Data"))),l.a.createElement("br",null),this.props.hasDownloads?l.a.createElement(Wt.a,null,l.a.createElement(Wt.a.Header,null,"Retrieved Rainfall Data"),l.a.createElement(Ta,{contextType:this.props.contextType,rainfallDataType:this.props.rainfallDataType})):null)}}]),a}(l.a.Component));var xa=Object(c.b)((function(e,t){var a=function(e,t){var a={};return Object(O.a)(ge(e,t).sensorLocations,(function(e,t){e.length>0&&(a[t]=e)})),a}(e,t.contextType),n=ye(e,t.contextType);return{hasKwargs:!Object(fe.a)(a),hasDownloads:n.length>0}}),(function(e,t){return{fetchRainfallData:function(t){e(at(t))}}}))(Da),ka=a(772),Sa=a(770),Ca=(a(321),l.a.createElement(ka.a,{id:"popover-basic"},l.a.createElement(ka.a.Title,{as:"h3"},"Provisional Data Disclaimer"),l.a.createElement(ka.a.Content,null,"Data shown here are provisional and subject to revision until they have been thoroughly reviewed and received final approval. Current condition data relayed by satellite or other telemetry are automatically screened to not display improbable values until they can be verified. Provisional data may be inaccurate due to instrument malfunctions or physical changes at the measurement site. Subsequent review based on field inspections and measurements may result in significant revisions to the data. Data users are cautioned to consider carefully the provisional nature of the information before using it for decisions that concern personal or public safety or the conduct of business that involves substantial monetary or operational consequences. Information concerning the accuracy and appropriate uses of these data or concerning other hydrologic data may be obtained from the 3RWW."))),Aa=function(e){Object(Ye.a)(a,e);var t=Object(Fe.a)(a);function a(){return Object(Me.a)(this,a),t.apply(this,arguments)}return Object(He.a)(a,[{key:"render",value:function(){return l.a.createElement(ze.a,null,l.a.createElement(Ke.a,null,l.a.createElement("h1",{className:"data-type-header"},"Real-time Rainfall",l.a.createElement("br",null),l.a.createElement("small",null,l.a.createElement(Sa.a,{trigger:"click",placement:"right",overlay:Ca},l.a.createElement(Je.a,{variant:"light",size:"sm"},"Provisional Data Disclaimer"))))))}}]),a}(l.a.Component),Ia=(a(745),function(e){Object(Ye.a)(a,e);var t=Object(Fe.a)(a);function a(){return Object(Me.a)(this,a),t.apply(this,arguments)}return Object(He.a)(a,[{key:"render",value:function(){return this.props.isAppThinking?l.a.createElement("div",{className:"thinking-overlay"},l.a.createElement("div",{className:"d-flex thinking-content"},l.a.createElement("span",{className:"fa-layers fa-fw"},l.a.createElement(aa.a,{icon:na.d,pulse:!0,size:"8x"}),l.a.createElement(aa.a,{icon:na.b,size:"4x",transform:"right-8"}))),l.a.createElement("p",{className:"debug-messages"},this.props.message)):null}}]),a}(l.a.Component));var Ra=Object(c.b)((function(e){var t=e.progress.messages;return{isAppThinking:e.progress.isThinking>0,message:t[t.length-1]}}))(Ia),Na=function(e){Object(Ye.a)(a,e);var t=Object(Fe.a)(a);function a(){return Object(Me.a)(this,a),t.apply(this,arguments)}return Object(He.a)(a,[{key:"render",value:function(){return l.a.createElement("div",{className:"fill no-gutters"},l.a.createElement(Ra,null),l.a.createElement(ze.a,null,l.a.createElement(Ke.a,null)),l.a.createElement(ze.a,{className:"fill no-gutters"},l.a.createElement(Ke.a,{sm:5,className:"scrolling-column"},l.a.createElement(st.a,{className:"sidebar"},l.a.createElement(ct.a,null,l.a.createElement(ut.a,{active:this.props.tab===L,eventKey:L,title:"Real-Time Rainfall"},l.a.createElement(Aa,null),l.a.createElement(xa,{contextType:L,rainfallDataType:R,rainfallSensorTypes:[N.gauge,N.pixel]})),l.a.createElement(ut.a,{active:this.props.tab===P,eventKey:P,title:"Historical Rain Gauge"},l.a.createElement("h1",{className:"data-type-header"},"Historical Rain Gauge Data"),l.a.createElement("p",null,"Historic rain gauge data has been through a QA/QC process by ALCOSAN and 3RWW, where data errors caused by the hardware have been addressed."),l.a.createElement(xa,{contextType:P,rainfallDataType:I,rainfallSensorTypes:[N.gauge]})),l.a.createElement(ut.a,{active:this.props.tab===_,eventKey:_,title:"Calibrated Radar Rainfall"},l.a.createElement("h1",{className:"data-type-header"},"Calibrated Radar Rainfall"),l.a.createElement("p",null,"Calibrated radar rainfall data is NEXRAD radar rainfall data adjusted using our rain gauge network. Calibration is performed by ",l.a.createElement("a",{href:"https://www.vieuxinc.com/",target:"_blank"},"Vieux Associates"),"."),l.a.createElement(dt.a,{variant:"warning"},l.a.createElement("strong",null,"Please note:")," We are currently migrating historic calibrated radar rainfall data to a new database; consequently rainfall data downloaded here will be incomplete."),l.a.createElement(xa,{contextType:_,rainfallDataType:I,rainfallSensorTypes:[N.pixel]}))))),l.a.createElement(Ke.a,{sm:7,className:"map-column"},l.a.createElement(Ut,{token:this.props.token,styleUrl:this.props.styleId,latitude:this.props.latitude,longitude:this.props.longitude,zoom:this.props.zoom}))))}}]),a}(l.a.Component);var La={switchContext:rt},Pa=Object(c.b)((function(e){return Object(h.a)(Object(h.a)({},e.initMap),{},{tab:e.progress.tab})}),La)(Na),_a=function(e){Object(Ye.a)(a,e);var t=Object(Fe.a)(a);function a(){return Object(Me.a)(this,a),t.apply(this,arguments)}return Object(He.a)(a,[{key:"render",value:function(){return l.a.createElement("div",{style:{height:"100%"}},l.a.createElement(qe.a,{defaultActiveKey:L,id:"rainfall-tabs",onSelect:this.props.switchContext},l.a.createElement(it,{isloading:this.props.loading}),l.a.createElement(Pa,null)))}}]),a}(l.a.Component);var Ma=Object(c.b)((function(e){return Object(h.a)({},e.initMap)}),(function(e,t){return{switchContext:function(t){console.log("switching",t),e(rt(t))}}}))(_a);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));console.log("Hello there curious person! The 3RWW Rainfall API is located at","https://trwwapi.herokuapp.com/rainfall/","- check it out for more powerful querying capability!"),s.a.render(l.a.createElement(c.a,{store:_e},l.a.createElement(Ma,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[339,1,2]]]);
//# sourceMappingURL=main.a185eead.chunk.js.map